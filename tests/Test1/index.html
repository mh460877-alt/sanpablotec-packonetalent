<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DAT - Test Completo de Aptitudes (6 Módulos)</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* === ESTILOS GLOBALES === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      background-image: url('./img/fondo-escencial.jpg'); 
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 24px;
      color: #1e293b;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding: 40px;
      position: relative;
      overflow: hidden;
    }

    /* HEADER */
    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0;
    }
    .header h1 { color: #0f172a; font-size: 24px; font-weight: 700; }
    .timer-badge {
      background: #0b4a6e; color: white; padding: 8px 16px; border-radius: 12px;
      font-size: 20px; font-weight: 700; box-shadow: 0 4px 6px rgba(11, 74, 110, 0.2);
    }
    
    /* SECCIONES */
    .section { display: none; animation: fadeIn 0.4s ease-in-out; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* FORMULARIOS */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #475569; }
    .form-input {
      width: 100%; padding: 12px; border: 2px solid #cbd5e1; border-radius: 10px;
      font-size: 16px; transition: 0.3s;
    }
    .form-input:focus { border-color: #0b4a6e; outline: none; box-shadow: 0 0 0 3px rgba(11, 74, 110, 0.1); }

    /* BOTONES */
    .btn {
      background: linear-gradient(135deg, #0b4a6e 0%, #020f27 100%);
      color: white; border: none; padding: 14px 28px; border-radius: 10px;
      font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(11, 74, 110, 0.3); }
    .btn-secondary { background: #64748b; margin-top: 10px; }

    /* INSTRUCCIONES */
    .instructions-box {
      background: #f1f5f9; padding: 25px; border-radius: 12px; border-left: 5px solid #0b4a6e;
      margin-bottom: 25px; line-height: 1.6; font-size: 16px; text-align: justify;
    }

    /* TEST GRID (RAPIDEZ) */
    .test-wrapper {
      max-height: 600px; overflow-y: auto; padding-right: 10px;
      scroll-behavior: smooth;
    }
    .test-row {
      display: grid; grid-template-columns: 50px 150px 1fr; gap: 15px; align-items: center;
      background: white; padding: 10px; border-bottom: 1px solid #e2e8f0;
    }
    .test-row:nth-child(even) { background: #f8fafc; }
    
    .q-id { font-weight: bold; color: #94a3b8; text-align: center; }
    
    .q-target {
      font-family: 'Courier New', monospace; font-size: 22px; font-weight: bold; color: #0b4a6e;
      text-align: center; text-decoration: underline; letter-spacing: 1px;
    }

    .q-options { display: flex; gap: 8px; flex-wrap: wrap; }
    
    .opt-btn {
      flex: 1; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; background: white;
      font-family: 'Courier New', monospace; font-size: 16px; cursor: pointer;
      min-width: 50px; text-align: center; transition: 0.1s;
    }
    .opt-btn:hover { background: #e2e8f0; }
    .opt-btn.selected { background: #0b4a6e; color: white; border-color: #0b4a6e; }

    /* ESTADO INTERMEDIO */
    .intermission { text-align: center; padding: 40px; }
    .intermission h2 { color: #0b4a6e; margin-bottom: 15px; }

    /* PREGUNTAS VERBALES/ORTOGRAFÍA/NUMERICO */
    .question-item {
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 30px;
      margin-bottom: 30px;
    }
    .q-number {
      font-weight: bold;
      color: #0b4a6e;
      font-size: 1.1rem;
      margin-bottom: 10px;
      display: block;
    }
    .q-text {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 20px;
      color: #334155;
    }

    .options-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 600px) {
      .options-list { grid-template-columns: 1fr 1fr; }
    }

    .opt-btn-verbal {
      background: white;
      border: 2px solid #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
      font-size: 1rem;
      display: flex;
      align-items: center;
    }
    .opt-btn-verbal:hover {
      border-color: #94a3b8;
      background: #f1f5f9;
    }
    .opt-btn-verbal.selected {
      border-color: #0b4a6e;
      background: #e0f2fe;
      color: #0b4a6e;
      font-weight: bold;
    }
    .opt-letter {
      font-weight: bold;
      margin-right: 10px;
      color: #0b4a6e;
    }

    /* ORTOGRAFÍA - GRID DE 2 COLUMNAS */
    .question-item-ortografia {
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 20px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      width: 100%;
    }
    @media (max-width: 600px) {
      .options-grid { grid-template-columns: 1fr; }
    }

    .example-box {
      margin-top: 15px;
      padding: 15px;
      background: #fff;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
    }
    .example-label {
      color: #0b4a6e;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.9rem;
      margin-bottom: 5px;
      display: block;
    }

    /* PREGUNTAS VISUALES (ABSTRACTO/ESPACIAL) */
    .question-visual {
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      background: #fafafa;
    }
    .question-visual img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 10px auto;
    }
    .visual-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    .visual-opt-btn {
      width: 60px;
      height: 60px;
      border: 2px solid #cbd5e1;
      border-radius: 10px;
      background: white;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    .visual-opt-btn:hover {
      border-color: #0b4a6e;
      background: #f0f9ff;
    }
    .visual-opt-btn.selected {
      background: #0b4a6e;
      color: white;
      border-color: #0b4a6e;
    }

    /* PROGRESS BAR */
    .progress-container {
      margin-bottom: 20px;
    }
    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0b4a6e, #1e88e5);
      transition: width 0.3s;
    }
    .progress-text {
      font-size: 12px;
      color: #64748b;
      margin-top: 5px;
      text-align: right;
    }

  </style>
</head>
<body>

<div class="container">
  
  <div class="header">
    <h1 id="pageTitle">Test DAT - Evaluación de Aptitudes</h1>
    <div id="timerDisplay" class="timer-badge" style="display:none">03:00</div>
  </div>

  <!-- ========== REGISTRO ========== -->
  <div id="loginSection" class="section active">
    <h2 style="margin-bottom: 20px; color: #0f172a;">Registro</h2>
    <div class="form-group">
      <label>Nombre</label>
      <input type="text" id="userName" class="form-input" placeholder="Ingrese su nombre">
    </div>
    <div class="form-group">
      <label>Apellido</label>
      <input type="text" id="userLast" class="form-input" placeholder="Ingrese su apellido">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="userEmail" class="form-input" placeholder="Ingrese su correo">
    </div>
    <button class="btn" onclick="goToInstructions()">Continuar</button>
  </div>

  <!-- ========== TEST 1: RAPIDEZ - INSTRUCCIONES ========== -->
  <div id="instSection1" class="section">
    <h2>Test 1: Rapidez y Exactitud Perceptiva</h2>
    <div class="instructions-box">
      <p>En esta prueba se trata de ver lo rápida y correctamente que es capaz de comparar grupos de letras y números.</p>
      <p><strong>Tarea:</strong> En cada ejercicio verá un grupo <u>subrayado</u> a la izquierda. Su tarea es encontrar EXACTAMENTE el mismo grupo entre las opciones de la derecha y seleccionarlo.</p>
      <p><strong>Tiempo:</strong> Dispondrá de <strong>3 minutos</strong> para la Parte I y, tras una pausa, <strong>3 minutos</strong> para la Parte II.</p>
      <p>Trabaje lo más rápido posible sin cometer errores.</p>
    </div>
    <button class="btn" onclick="startTest1Part(1)">COMENZAR PARTE I</button>
  </div>

  <!-- ========== TEST 1: RAPIDEZ - PARTE I ========== -->
  <div id="testSection1" class="section">
    <h3 id="partTitle1" style="margin-bottom: 15px; color: #64748b;">Parte I</h3>
    <div id="testGrid1" class="test-wrapper"></div>
    <button class="btn" id="finishPartBtn1" style="margin-top: 20px;" onclick="finishTest1Part()">FINALIZAR PARTE</button>
  </div>

  <!-- ========== TEST 1: INTERMEDIO ========== -->
  <div id="intermissionSection1" class="section intermission">
    <h2>¡Parte I Completada!</h2>
    <p>Ha completado la Parte I del Test de Rapidez y Exactitud Perceptiva.</p>
    <p>Cuando esté listo, presione el botón para iniciar la Parte II (3 minutos).</p>
    <br>
    <button class="btn" onclick="startTest1Part(2)">COMENZAR PARTE II</button>
  </div>

  <!-- ========== TRANSICIÓN TEST 1 → TEST 2 ========== -->
  <div id="transitionSection1to2" class="section intermission">
    <h2>✓ Test 1 Completado</h2>
    <p>Ha finalizado el Test de Rapidez y Exactitud Perceptiva.</p>
    <p>A continuación comenzará el Test 2: Razonamiento Verbal.</p>
    <br>
    <button class="btn" onclick="showInstructions2()">CONTINUAR AL TEST 2</button>
  </div>

  <!-- ========== TEST 2: RAZONAMIENTO VERBAL - INSTRUCCIONES ========== -->
  <div id="instSection2" class="section">
    <h2>Test 2: Razonamiento Verbal</h2>
    <div class="instructions-box">
      <p>Esta prueba consta de frases o proposiciones a las que les faltan la primera y la última palabra que se han sustituido por puntos. Su tarea consiste en encontrar las palabras que faltan de modo que, cuando se halla completado, la relación entre la primera y la segunda parte de cada frase sea semejante y la frase resulte verdadera y con sentido.</p>
      <p>Para ello ha de elegir entre los cinco pares de palabras que se proponen como opciones de respuestas. La primera palabra del par debe ir al principio de la frase y la segunda al final.</p>
    </div>

    <div class="instructions-box">
      <span class="example-label">Ejemplo E 1</span>
      <p>... es a maullar como perro es a ...</p>
      <div class="example-box">
        <div>A. ladrar – cachorro</div>
        <div style="font-weight:bold; color:#0b4a6e;">B. gato – ladrar (Correcta)</div>
        <div>C. gato – morder</div>
        <div>D. foca – cazar</div>
        <div>E. arañar – hueso</div>
      </div>
      <p style="font-size: 0.9rem; margin-top:10px;">La respuesta correcta es la B, porque gato y maullar se relacionan de modo semejante a como lo hacen perro y ladrar.</p>
    </div>

    <button class="btn" onclick="startTest2()">COMENZAR TEST 2 (25 MIN)</button>
  </div>

  <!-- ========== TEST 2: RAZONAMIENTO VERBAL ========== -->
  <div id="testSection2" class="section">
    <div id="questionsContainer2" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" onclick="finishTest2()">FINALIZAR TEST 2</button>
  </div>

  <!-- ========== TRANSICIÓN TEST 2 → TEST 3 ========== -->
  <div id="transitionSection2to3" class="section intermission">
    <h2>✓ Test 2 Completado</h2>
    <p>Ha finalizado el Test de Razonamiento Verbal.</p>
    <p>A continuación comenzará el Test 3: Ortografía.</p>
    <br>
    <button class="btn" onclick="showInstructions3()">CONTINUAR AL TEST 3</button>
  </div>

  <!-- ========== TEST 3: ORTOGRAFÍA - INSTRUCCIONES ========== -->
  <div id="instSection3" class="section">
    <h2>Test 3: Ortografía</h2>
    <div class="instructions-box">
      <p>En esta prueba se presentan grupos de cuatro palabras entre las cuales hay una que está <strong>mal escrita</strong>. Su tarea consiste en descubrir cuál es la palabra en la que intencionalmente se ha cometido una falta de ortografía.</p>
      <p>Una vez que haya decidido cuál es la palabra incorrecta, debe marcar la opción correspondiente.</p>
    </div>

    <div class="instructions-box">
      <span class="example-label">Ejemplo E 1</span>
      <p>En este ejemplo, la palabra <em>benébolo</em> no está escrita correctamente; debía haberse escrito <strong>benévolo</strong>.</p>
      <div class="example-box">
        <div>A. Halago</div>
        <div style="font-weight:bold; color:#0b4a6e;">B. Benébolo (Incorrecta)</div>
        <div>C. Gentío</div>
        <div>D. Apoyar</div>
      </div>
    </div>

    <button class="btn" onclick="startTest3()">COMENZAR TEST 3 (10 MIN)</button>
  </div>

  <!-- ========== TEST 3: ORTOGRAFÍA ========== -->
  <div id="testSection3" class="section">
    <div id="questionsContainer3" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" onclick="finishTest3()">FINALIZAR TEST 3</button>
  </div>

  <!-- ========== TRANSICIÓN TEST 3 → TEST 4 ========== -->
  <div id="transitionSection3to4" class="section intermission">
    <h2>✓ Test 3 Completado</h2>
    <p>Ha finalizado el Test de Ortografía.</p>
    <p>A continuación comenzará el Test 4: Razonamiento Numérico.</p>
    <br>
    <button class="btn" onclick="showInstructions4()">CONTINUAR AL TEST 4</button>
  </div>

  <!-- ========== TEST 4: RAZONAMIENTO NUMÉRICO - INSTRUCCIONES ========== -->
  <div id="instSection4" class="section">
    <h2>Test 4: Razonamiento Numérico</h2>
    <div class="instructions-box">
      <p>Esta prueba intenta comprobar su capacidad para razonar con números. Lea cada ejercicio y observe las posibles respuestas que se ofrecen y decida cuál de ellas es la mejor.</p>
      <p><strong>IMPORTANTE:</strong> En algunos de los ejercicios, no aparece la respuesta correcta. En ese caso, debe marcar la opción <strong>E (Ninguna de ellas)</strong> que quiere decir que la respuesta correcta no es ninguna de las alternativas propuestas.</p>
      <p>Si necesita hacer cálculos, utilice papel aparte. No use calculadora.</p>
    </div>

    <div class="instructions-box">
      <span class="example-label">Ejemplo E 1</span>
      <p>¿Qué número continúa esta serie? 2 4 6 8 ?</p>
      <div class="example-box">
        <div>A. 9</div>
        <div style="font-weight:bold; color:#0b4a6e;">B. 10 (Correcta)</div>
        <div>C. 11</div>
        <div>D. 12</div>
        <div>E. Ninguna de ellas</div>
      </div>
    </div>

    <button class="btn" onclick="startTest4()">COMENZAR TEST 4 (30 MIN)</button>
  </div>

  <!-- ========== TEST 4: RAZONAMIENTO NUMÉRICO ========== -->
  <div id="testSection4" class="section">
    <div id="questionsContainer4" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" onclick="finishTest4()">FINALIZAR TEST 4</button>
  </div>

  <!-- ========== TRANSICIÓN TEST 4 → TEST 5 ========== -->
  <div id="transitionSection4to5" class="section intermission">
    <h2>✓ Test 4 Completado</h2>
    <p>Ha finalizado el Test de Razonamiento Numérico.</p>
    <p>A continuación comenzará el Test 5: Razonamiento Abstracto.</p>
    <br>
    <button class="btn" onclick="showInstructions5()">CONTINUAR AL TEST 5</button>
  </div>

  <!-- ========== TEST 5: RAZONAMIENTO ABSTRACTO - INSTRUCCIONES ========== -->
  <div id="instSection5" class="section">
    <h2>Test 5: Razonamiento Abstracto</h2>
    <div class="instructions-box">
      <p>En esta prueba se trata de apreciar la capacidad para razonar con figuras y dibujos. En cada fila hay cuatro figuras llamadas PROBLEMA y cinco llamadas RESPUESTA.</p>
      <p><strong>Tarea:</strong> Las figuras PROBLEMA forman una serie porque están ordenadas siguiendo una ley. Su tarea consiste en elegir, entre las figuras RESPUESTA, la que debiera ir a continuación (es decir, la que sería la número cinco de la serie).</p>
      <p><strong>IMPORTANTE:</strong> Debe tener el cuadernillo de imágenes junto a usted para ver las figuras de cada pregunta.</p>
    </div>

    <div class="instructions-box">
      <span class="example-label">Ejemplo</span>
      <p>En el ejemplo E1, la flecha gira 90º en el sentido de las agujas del reloj de un recuadro a otro. La respuesta correcta es A porque la posición siguiente de la flecha debería ser vertical hacia arriba.</p>
    </div>

    <button class="btn" onclick="startTest5()">COMENZAR TEST 5 (25 MIN)</button>
  </div>

  <!-- ========== TEST 5: RAZONAMIENTO ABSTRACTO ========== -->
  <div id="testSection5" class="section">
    <div class="progress-container">
      <div class="progress-bar"><div id="progress5" class="progress-fill" style="width: 0%"></div></div>
      <div class="progress-text"><span id="progressText5">0</span> / 50</div>
    </div>
    <div id="questionsContainer5" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" onclick="finishTest5()">FINALIZAR TEST 5</button>
  </div>

  <!-- ========== TRANSICIÓN TEST 5 → TEST 6 ========== -->
  <div id="transitionSection5to6" class="section intermission">
    <h2>✓ Test 5 Completado</h2>
    <p>Ha finalizado el Test de Razonamiento Abstracto.</p>
    <p>A continuación comenzará el Test 6: Relaciones Espaciales.</p>
    <br>
    <button class="btn" onclick="showInstructions6()">CONTINUAR AL TEST 6</button>
  </div>

  <!-- ========== TEST 6: RELACIONES ESPACIALES - INSTRUCCIONES ========== -->
  <div id="instSection6" class="section">
    <h2>Test 6: Relaciones Espaciales</h2>
    <div class="instructions-box">
      <p>Esta prueba consta de 50 ejercicios. En cada uno de ellos se presenta un modelo o patrón en el que algunas zonas están sombreadas.</p>
      <p><strong>Tarea:</strong> A la derecha de cada modelo se ofrecen cuatro figuras de tres dimensiones. Su tarea consiste en averiguar cuál de esas figuras es la <strong>única</strong> que ha podido formarse a partir del modelo. El modelo siempre presenta la parte exterior de la figura.</p>
      <p><strong>IMPORTANTE:</strong> Debe tener el cuadernillo de imágenes junto a usted para ver las figuras de cada pregunta.</p>
    </div>

    <div class="instructions-box">
      <span class="example-label">Ejemplo</span>
      <p>En el ejemplo E1, el modelo formará una caja rectangular con las dos caras mayores y una de las pequeñas laterales sombreadas. La respuesta correcta es D porque la cara superior y uno de los laterales cortos están sombreados.</p>
    </div>

    <button class="btn" onclick="startTest6()">COMENZAR TEST 6 (25 MIN)</button>
  </div>

  <!-- ========== TEST 6: RELACIONES ESPACIALES ========== -->
  <div id="testSection6" class="section">
    <div class="progress-container">
      <div class="progress-bar"><div id="progress6" class="progress-fill" style="width: 0%"></div></div>
      <div class="progress-text"><span id="progressText6">0</span> / 50</div>
    </div>
    <div id="questionsContainer6" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" onclick="finishTest6()">FINALIZAR TEST 6</button>
  </div>

  <!-- ========== FINAL ========== -->
  <div id="finalSection" class="section intermission">
    <h2 style="color: #059669;">¡Tests Completados!</h2>
    <div style="font-size: 60px; margin: 20px 0;">✅</div>
    <p>Ha completado todos los tests de la evaluación DAT.</p>
    <p>Sus respuestas han sido registradas correctamente.</p>
    <div id="loadingMsg" style="margin-top:20px; color:#0b4a6e; font-weight:bold;">Guardando datos...</div>
  </div>

</div>

<script>
  // ========== DATOS TEST 1: RAPIDEZ ==========
  const RAW_TEXT_P1 = `1 nv nx xn vx xv 21 ar ra ro ar oa 41 7c 9b 9c 9e 7b 61 HN HZ ZH ZN NH 81 35 53 h3 3h 5h
2 bl dl ld lb bd 22 lc la al ac ca 42 7c 2b 7b 2d 7d 62 RR BR RB BB RP 82 bl dl ld lb bd
3 ar au ur ra ru 23 1s 13 31 3s s1 43 n3 Sn 3s ns 3n 63 CU UU UC US CC 83 fk lk kf lf kl
4 wu vu vw wv uw 24 ma cm ca mc am 44 20 25 02 05 52 64 PR PB RB RP BP 84 69 6d 9d d6 d9
5 wm um mu wu mw 25 xv vx vw wx wv 45 ec ac ca ce ae 65 CK KJ JC KC JK 85 XX VX VZ ZV XV
6 79 76 67 69 97 26 ud un nd nu du 46 2h h4 42 4h 24 66 T1 1T 11 Tt TT 86 j8 a8 8a 8j ja
7 ra na nr rn ar 27 fk lk kt lt kl 47 av va vo ao ov 67 SX sX sx Xs XS 87 79 76 67 69 97
8 za mz zm az ma 28 pq qg gp gq qp 48 fa fr ra rf ar 68 LT Tt tT Tl tt 88 nr ne en rn re
9 AV VN NV NA VA 29 2u 2q qu q2 u2 49 ma cm ca mc am 69 Zz NZ zZ zn ZN 89 4X 4V Vx V4 x4
10 OQ CQ QC QO OC 30 41 44 14 11 40 50 rc cr co oc or 70 GQ Qg qq qg QG 90 vn vz zv nv zn
11 CU UU UC US CC 31 nr ne en rn re 51 Ch ho hc ac oh 71 4c 1a 1c 4d 2d 91 B8 R8 8B RB 8R
12 4H 4N NH N4 HN 32 bb dd ld db bd 52 se rs re es er 72 S8 C3 S3 C8 C5 92 oQ CQ QC QO OC
13 Rr RP pR PP RR 33 RB RD DR BR BD 53 ar au ur ra ru 73 A9 7b 79 9b b7 93 OD OB BD DO BO
14 Aa AB 8a 8A aA 34 MW MV VW VM WM 54 pq qg gp gq qp 74 18 81 71 78 17 94 ZY ZX XY YZ YX
15 LT Tt tT Tl tt 35 OD OB BD DO BO 55 am na nm mn an 75 b4 4d db d4 bd 95 OU OC UC UD CO
16 Av Vv av VV AA 36 PR PB RB RP BP 56 gj jg pg jp gp 76 u6 u4 4u 6u 46 96 Cc Oc OO cO cc
17 4d 3c 4a 4c 3a 37 Dd Db dB bD DD 57 tp et ep pe pt 77 3x 7x 73 37 x7 97 Aa A8 8a 8A aA
18 X7 V9 V5 X9 V7 38 EE Ef eF Fe FF 58 ra na nr rn ar 78 1s 13 31 3s s1 98 Ze Zz ZE zE eZ
19 A9 7b 79 9b b7 39 Ze Zz ZE zE eZ 59 bb dd ld db bd 79 en dn de ed nd 99 BP Pb bP pp bB
20 20 25 02 05 52 40 Zz NZ zZ zn ZN 60 18 81 1a 8a a8 80 ni fi fn in nf 100 Cz CZ Zc zC cz`;

  const RAW_TEXT_P2 = `1 YZ VY VX XY ZY 21 Rr RP pR PP rr 41 WU VU VW WV UW 61 18 81 71 78 17 81 se rs re es er
2 b9 C6 69 96 6C 22 LT IT IL TL TI 42 er ri ir ie re 62 Vv Ww Wv wV vv 82 4X 4V VX VA X4
3 ou oa ua uo ao 23 MW MV VW VM WM 43 31 23 32 13 21 63 Mm MN NN nn mM 83 zn zz nz nn mn
4 lc lo ol oc co 24 Uu Wu uW WW uU 44 2u 2q qu q2 u2 64 b9 c6 69 96 6c 84 LT IT IL TL TI
5 X7 V9 V5 X9 V7 25 3x xc c3 cx 3c 45 XV VX VW WX WV 65 4c 1a 1c 4d 2d 85 41 44 14 11 40
6 Sc 8c 8s cS c8 26 AV VN NV NA VA 46 ae et ea ta te 66 2h h4 42 4h 24 86 us ue se su eu
7 ob bt ot tb bo 27 YX XX Yy Xy xX 47 VI SI SV VS IV 67 YZ VY VX XY ZX 87 PR PB RB RP BP
8 5e 3d 4d 2e 2d 28 EL FL FE LF LE 48 th he et en ht 68 n3 Sn 3s ns 3n 88 Rr RP pR PP rr
9 rc dc dr rd cr 29 MN NM VN MV NV 49 za mz zm az ma 69 WO ro rw ow wr 89 SX sX sx Xs XS
10 ws sw st tw ts 30 EE Ef eF Fe FF 50 sx sa ax xs xa 70 ar ra ro or oa 90 ra na nr rn ar
11 wm um mu wu mw 31 S8 C8 8C 8S S5 51 Av Vv aV VV AA 71 ni fi fn in nf 91 OU OC UC UO CO
12 pp qq pq pg qp 32 h6 h8 86 8h 6h 52 Mw wW WM MM mW 72 wu vu vw wv uw 92 RB RD DR BR BD
13 nv nx xn vx xv 33 4d 3c 4a 4c 3a 53 4H 4N NH N4 HN 73 th he et eh ht 93 XX XO OO OX OV
14 nu un um mn mu 34 Z4 Z1 14 1Z 4Z 54 Dd Db dB bB DD 74 am na nm mn an 94 HN HZ ZH ZN NH
15 zn zz nz nn mn 35 Qo Qq OQ oq QQ 55 s8 83 s3 38 3S 75 3x 7x 73 37 x7 95 Av Vv aV VV AA
16 pg gy py yp yg 36 xc ex ec ce xe 56 XO OO OX OV XX 76 j8 a8 8a 8j ja 96 OQ CQ QC QO OC
17 59 gY 5Y Y9 95 37 ar ra ro or oa 57 S8 C8 8C 8S S5 77 59 9Y 5Y Y9 95 97 2e Zz ZE zE eZ
18 nu on ou un uo 38 8c 8a 7a 6c 7c 58 X7 V9 V5 x9 V7 78 fk lk kf lf kl 98 GQ Qg qq qg QG
19 ud un nd nu du 39 us ue se su eu 59 L7 L1 17 1L 7L 79 ma cm ca mc am 99 Mm MN NN nn mM
20 41 44 14 11 40 40 wo ro rw ow wr 60 RB RD DR BR BD 80 nv nx xn vx xv 100 Qo Qq OQ oq QQ`;

  function parseText(text) {
    const qs = [];
    const lines = text.split('\n');
    lines.forEach(line => {
      const tokens = line.split(/\s+/).filter(t => t.trim() !== '');
      let i = 0;
      while(i < tokens.length) {
        if(tokens[i].match(/^\d+$/)) {
          const id = parseInt(tokens[i]);
          if(i+5 < tokens.length) {
            const opts = tokens.slice(i+1, i+6);
            qs.push({ id: id, target: opts[0], options: opts.sort(() => Math.random() - 0.5) }); 
            i += 6;
          } else { i++; }
        } else { i++; }
      }
    });
    return qs.sort((a,b) => a.id - b.id);
  }

  const DB_TEST1 = {
    1: parseText(RAW_TEXT_P1),
    2: parseText(RAW_TEXT_P2)
  };

  // ========== DATOS TEST 2: RAZONAMIENTO VERBAL ==========
  const QUESTIONS_TEST2 = [
    { id: 1, text: "…es a olor como oído es a…", options: ["olfato – aroma", "nariz – sonido", "color – timbre", "percibir – armonía", "nariz – ojo"] },
    { id: 2, text: "…es a sollozo como risa es a…", options: ["llanto – dolor", "lágrima – grito", "llanto – sonrisa", "tristeza – dolor", "gemido – pena"] },
    { id: 3, text: "…es a después como arriba es a...", options: ["así – abajo", "sobre – mientras", "pronto – encima", "antes – abajo", "antes – mientras"] },
    { id: 4, text: "…es a avión como maquinista es a...", options: ["hangar – estación", "comandante – piloto", "piloto – tren", "aeropuerto – locomotora", "hangar – vía"] },
    { id: 5, text: "…es a prado como árbol es a...", options: ["hierba – bosque", "verde – fruta", "campo – flor", "vaca – hoja", "huerto – paisaje"] },
    { id: 6, text: "…es a rama como pétalo es a…", options: ["tronco – semilla", "madera – color", "tronco – fruto", "pájaro – flor", "hoja – flor"] },
    { id: 7, text: "…es a agrio como miel es a…", options: ["dulce – azúcar", "amargo – hiel", "pomelo – abeja", "vinagre – vino", "limón – dulce"] },
    { id: 8, text: "…es a recluso como hospital es a…", options: ["inocente – enfermo", "criminal– cárcel", "cárcel – enfermo", "victima – salud", "reo – médico"] },
    { id: 9, text: "…es a construir como demoler es a...", options: ["fabricar – urbanizar", "puente – ruina", "edificar – destruir", "derribar – conservar", "puente – escombro"] },
    { id: 10, text: "…es a madera como sastre es a...", options: ["herramienta – coser", "mueble – tela", "carpintero – tela", "ebanista – modista", "serrar – cortar"] },
    { id: 11, text: "…es a general como particular es a…", options: ["singular – raro", "común – propio", "ordinario – extraño", "habitual – universal", "exclusivo – peculiar"] },
    { id: 12, text: "…es a funda como espada es a…", options: ["caja – herida", "cuero – corte", "pistola – vaina", "arma – acero", "desenvainar – luchar"] },
    { id: 13, text: "…es a mano como pierna es a…", options: ["dedo – pie", "brazo – pie", "gesto – rodilla", "tocar – calzar", "dedo – zapato"] },
    { id: 14, text: "…es a ciudad como rural es a...", options: ["multitud – aldea", "ruido – campesino", "pueblo – rústico", "urbano – campo", "civil – ganadero"] },
    { id: 15, text: "…es a pluma como pesadez es a...", options: ["escribir – discurso", "aire – ligereza", "ligereza – tamaño", "tinta – piedra", "ligereza – plomo"] },
    { id: 16, text: "…es a tarde como anticiparse es a…", options: ["mañana – madrugar", "ahora – nunca", "nunca – retrasarse", "pronto – retrasarse", "madrugar – ahora"] },
    { id: 17, text: "…es a trópico como glacial es a...", options: ["cálido – ártico", "polo– frío", "Ecuador – frío", "polo – ártico", "selva – Ecuador"] },
    { id: 18, text: "…es a autorizar como dificultar es a...", options: ["tolerar – impedir", "permitir – ceder", "prohibir – estorbar", "evitar – prohibir", "consentir – facilitar"] },
    { id: 19, text: "…es a escuela como médico es a...", options: ["educación – sanidad", "estudiante – enfermo", "libro – medicina", "edificio – hospital", "maestro – hospital"] },
    { id: 20, text: "…es a lealtad como perfidia es a...", options: ["patriotismo – envidia", "fidelidad – traición", "amistad – cobardía", "patriotismo – cobardía", "engaño – traición"] },
    { id: 21, text: "…es a letra como diccionario es a…", options: ["abecedario – palabra", "escritura – definición", "palabra – libro", "vocal – consonante", "carta – libro"] },
    { id: 22, text: "…es a historia como fábula es a...", options: ["geografía – mitología", "tradición – niño", "pasado – futuro", "crónica – leyenda", "geografía – poesía"] },
    { id: 23, text: "…es a alabar como infamar es a...", options: ["ensalzar – informar", "elevar – ensalzar", "denigrar – injuriar", "elogiar – agraviar", "difamar – injuriar"] },
    { id: 24, text: "…es a nuez como piel es a...", options: ["nogal – corteza", "cáscara – manzana", "fruta – pluma", "avellana – abrigo", "nogal – manzana"] },
    { id: 25, text: "…es a tiempo como aquí es a...", options: ["año – hoy", "temperatura – allí", "ahora – lugar", "pronto – prisa", "siempre – nunca"] },
    { id: 26, text: "…es a león como madriguera es a...", options: ["selva – refugio", "fiera – conejo", "tigre – refugio", "guarida – conejo", "garra – cueva"] },
    { id: 27, text: "…es a árbol como cimiento es a...", options: ["madera – edificio", "pared – columna", "raíz – edificio", "madera – columna", "fruto – base"] },
    { id: 28, text: "…es a amanecer como ocaso es a...", options: ["mañana – día", "madrugar – dormir", "luz – sol", "aurora – anochecer", "temprano – anochecer"] },
    { id: 29, text: "…es a peso como siglo es a...", options: ["tonelada – cien", "kilo – año", "cantidad – espacio", "densidad – medida", "tonelada – tiempo"] },
    { id: 30, text: "…es a pintar como buril es a...", options: ["artista – artesano", "pincel – grabar", "decorar – cincel", "cuadro – grabar", "cuadro – herramienta"] },
    { id: 31, text: "…es a oveja como colmena es a...", options: ["animal – miel", "lana – avispa", "hierba – flor", "rebaño – enjambre", "redil – abeja"] },
    { id: 32, text: "…es a certeza como vacilación es a...", options: ["falsedad – error", "seguridad – duda", "duda – titubeo", "confianza – seguridad", "afirmación – negación"] },
    { id: 33, text: "…es a vender como adquirir es a...", options: ["comprar – enajenar", "alquilar – comprar", "poseer – tener", "comerciar – pagar", "negociar – arrendar"] },
    { id: 34, text: "…es a nieve como riada es a...", options: ["frío – río", "hielo – inundación", "alud – agua", "avalancha – hielo", "granizo – amistad"] },
    { id: 35, text: "…es a sacerdote como toga es a...", options: ["misa – juicio", "obispo – juez", "liturgia – prestigio", "iglesia – uniforme", "casulla – magistrado"] },
    { id: 36, text: "…es a oveja como colmena es a...", options: ["animal – miel", "lana – avispa", "hierba – flor", "rebaño – enjambre", "redil – abeja"] },
    { id: 37, text: "…es a piel como templar es a...", options: ["cuerpo – curtir", "animal – endurecer", "proteger – moldear", "curtir – afinar", "curtir – hierro"] },
    { id: 38, text: "…es a año como tres es a...", options: ["trimestre – doce", "mes – cuatro", "siglo – trimestre", "día – uno", "calendario – impar"] },
    { id: 39, text: "…es a fiesta como tristeza es a...", options: ["diversión – alegría", "reunión – dolor", "animación – ceremonia", "alegría – duelo", "regalo – pésame"] },
    { id: 40, text: "…es a carga como yate es a...", options: ["trabajo – recreo", "pala – mar", "barco – pesca", "camión – ligero", "barcaza – recreo"] }
  ];

  // ========== DATOS TEST 3: ORTOGRAFÍA ==========
  const QUESTIONS_TEST3 = [
    { id: 1, options: ["significado", "hombro", "colunna", "santiguar"] },
    { id: 2, options: ["vecindad", "proibir", "oscilar", "mejilla"] },
    { id: 3, options: ["vestido", "patruya", "abrir", "levantar"] },
    { id: 4, options: ["gimnasia", "tobillo", "irreductible", "automóbil"] },
    { id: 5, options: ["volver", "cabello", "albergue", "immediato"] },
    { id: 6, options: ["ciudad", "huéspez", "turbina", "espanto"] },
    { id: 7, options: ["sez", "recoger", "cabecera", "colección"] },
    { id: 8, options: ["adtitud", "excesivo", "civil", "claridad"] },
    { id: 9, options: ["resbalar", "libertad", "ebidencia", "huevo"] },
    { id: 10, options: ["desechar", "embargo", "adtuación", "intuir"] },
    { id: 11, options: ["acoger", "extraño", "codorniz", "alegria"] },
    { id: 12, options: ["horgía", "advertir", "horizonte", "zueco"] },
    { id: 13, options: ["avusivo", "voraz", "salvar", "convicción"] },
    { id: 14, options: ["quehacer", "onnipotencia", "acabar", "imaginar"] },
    { id: 15, options: ["próximo", "bíscera", "vejez", "malla"] },
    { id: 16, options: ["vergüenza", "horadado", "ensayo", "clavo"] },
    { id: 17, options: ["abrevadero", "elecho", "mágico", "calavera"] },
    { id: 18, options: ["escurrir", "espulsar", "cadáver", "cebolla"] },
    { id: 19, options: ["servicio", "arriba", "trasluz", "ornacina"] },
    { id: 20, options: ["desorbitado", "horizontal", "privacion", "desmayo"] },
    { id: 21, options: ["origen", "ahora", "ingerto", "privilegio"] },
    { id: 22, options: ["huella", "esbelto", "subrallar", "adversario"] },
    { id: 23, options: ["bidón", "humillación", "agujero", "seberidad"] },
    { id: 24, options: ["alevín", "baticinio", "dentellada", "abeja"] },
    { id: 25, options: ["decepción", "malhumor", "retaíla", "bombilla"] },
    { id: 26, options: ["constatar", "luz", "agobiado", "zizaña"] },
    { id: 27, options: ["observar", "hurgar", "balsa", "zunbido"] },
    { id: 28, options: ["deshacer", "relucir", "congetura", "yacimiento"] },
    { id: 29, options: ["bugía", "débil", "ceño", "mandíbula"] },
    { id: 30, options: ["accidente", "embalage", "sonreír", "barquillo"] },
    { id: 31, options: ["ambiguo", "guijarro", "cobarde", "collote"] },
    { id: 32, options: ["conminar", "ájil", "arcilla", "rigidez"] },
    { id: 33, options: ["huerto", "estrecho", "torvo", "espléndido"] },
    { id: 34, options: ["extracción", "hechizo", "uraño", "insobornable"] },
    { id: 35, options: ["enarbolar", "efecto", "abellana", "horror"] },
    { id: 36, options: ["exámen", "ahí", "envío", "alivio"] },
    { id: 37, options: ["vidrio", "orificio", "nariz", "esquisito"] },
    { id: 38, options: ["habituar", "voz", "orilla", "incapié"] },
    { id: 39, options: ["desorbitado", "visillo", "expontáneo", "aborrecer"] },
    { id: 40, options: ["enrrollar", "laúd", "pared", "ávido"] }
  ];

  // ========== DATOS TEST 4: RAZONAMIENTO NUMÉRICO ==========
  const QUESTIONS_TEST4 = [
    { id: 1, text: "¿Qué número continúa esta serie? 2  5  8  11  ?", options: ["24", "22", "19", "14", "Ninguna de ellas"] },
    { id: 2, text: "¿Qué cifra debería sustituir a la B en esta multiplicación? 27B × 2 = 552", options: ["0", "1", "4", "6", "Ninguna de ellas"] },
    { id: 3, text: "5 − 12 =", options: ["−12 + 5", "12 − 5", "−(5 − 12)", "−(12 + 5)", "Ninguna de ellas"] },
    { id: 4, text: "¿Qué cifra debería ir en lugar de la P en esta suma? 4PPP4 + 4PP7 = 47671", options: ["9", "8", "3", "2", "Ninguna de ellas"] },
    { id: 5, text: "¿Cuánto es ½ de 1,39 euros redondeados a los diez céntimos más próximos?", options: ["0,60", "0,70", "1,40", "2,80", "Ninguna de ellas"] },
    { id: 6, text: "¿Qué número puede sustituir a la L para que la proporción sea correcta? 4/L = L/36", options: ["3", "9", "12", "18", "Ninguna de ellas"] },
    { id: 7, text: "¿Qué cifra debería sustituir a la F en esta resta? 112 − F4 = 18", options: ["9", "7", "6", "5", "Ninguna de ellas"] },
    { id: 8, text: "¿Por qué número es divisible exactamente la suma de 132 más 402?", options: ["4", "6", "8", "9", "Ninguna de ellas"] },
    { id: 9, text: "¿Qué número debería sustituir a la R para que esta operación sea correcta? 38 + R + 67 = 180", options: ["85", "95", "105", "285", "Ninguna de ellas"] },
    { id: 10, text: "4 = 10% de ______", options: ["0,4", "4", "40", "400", "Ninguna de ellas"] },
    { id: 11, text: "¿Cuál de estas expresiones es mayor que la unidad?", options: ["3/6 + 5/10", "3/5 + 6/10", "2/4 + 1/2", "1/3 + 1/3", "Ninguna de ellas"] },
    { id: 12, text: "¿Qué número debe sustituir a la N para que la proporción sea correcta? 6/N = 12/8", options: ["16", "5", "4", "2", "Ninguna de ellas"] },
    { id: 13, text: "Si y = 7, entonces 3 + 4y será =", options: ["49", "31", "25", "14", "Ninguna de ellas"] },
    { id: 14, text: "¿Qué cifra debería sustituir a la E en esta multiplicación? 2EE6 × 8 = 16E48", options: ["0", "3", "5", "7", "Ninguna de ellas"] },
    { id: 15, text: "¿Qué número continúa esta serie? 11  16  13  18  15  ?", options: ["23", "20", "16", "13", "Ninguna de ellas"] },
    { id: 16, text: "¿Qué cifra debería sustituir a la A en esta resta? 8A788 − 7AA7 = 773A1", options: ["9", "6", "5", "0", "Ninguna de ellas"] },
    { id: 17, text: "¿Qué cifra podría sustituir a la F en esta suma? F0F + 20F = 710", options: ["1", "3", "5", "9", "Ninguna de ellas"] },
    { id: 18, text: "¿Qué cifra podría sustituir a la N en esta resta? 3N3N3 − 3NN3 = 32700", options: ["1", "4", "5", "6", "Ninguna de ellas"] },
    { id: 19, text: "¿Qué número podría sustituir a la K? K/7 = 28/K", options: ["7/14", "15", "28", "112", "Ninguna de ellas"] },
    { id: 20, text: "¿Qué cifra podría sustituir a la L en esta suma? 87L9 + 9L89 = 18128", options: ["28", "24", "20", "16", "Ninguna de ellas"] },
    { id: 21, text: "¿Cuál de las expresiones vale MENOS que la unidad?", options: ["1/2 + 5/9", "7/8 + 1/4", "2/3 + 4/12", "2/5 + 1/4", "Ninguna de ellas"] },
    { id: 22, text: "¿Qué número es divisible exactamente entre 3?", options: ["766", "768", "796", "976", "Ninguna de ellas"] },
    { id: 23, text: "¿Qué cifra debería sustituir a la H en esta multiplicación? 3H3 × H3 = 4069", options: ["2", "5", "7", "8", "Ninguna de ellas"] },
    { id: 24, text: "¿Qué número falta en esta serie? 25  36  49  ?  81", options: ["56", "62", "64", "75", "Ninguna de ellas"] },
    { id: 25, text: "¿Cuál es el resultado de 710 × 80 redondeando al millar más próximo?", options: ["50.000", "55.000", "57.000", "60.000", "Ninguna de ellas"] },
    { id: 26, text: "¿Qué cifra debería sustituir a la C en esta suma? 457C7 + 3C7C7 = 77434", options: ["1", "2", "6", "8", "Ninguna de ellas"] },
    { id: 27, text: "20 × (18 × 5) tiene el mismo valor que…", options: ["20 × 23", "100 × 18", "(20×18) × (20×5)", "(20×18) + (20×5)", "Ninguna de ellas"] },
    { id: 28, text: "(5 × 2) / (4 × 15) =", options: ["6", "5/6", "2/3", "1/6", "Ninguna de ellas"] },
    { id: 29, text: "¿Qué número debe sustituir a la T en esta división? T2T3 : 1039 = T", options: ["4", "5", "7", "8", "Ninguna de ellas"] },
    { id: 30, text: "50% de 6.300 =", options: ["50", "126", "315", "3.500", "Ninguna de ellas"] },
    { id: 31, text: "¿Cuál es el número MÁS PEQUEÑO que es divisible exactamente por 10 y por 15?", options: ["60", "30", "25", "15", "Ninguna de ellas"] },
    { id: 32, text: "¿Qué cifra debería sustituir a la A en esta resta? 1A31 − 3A9 = 1352", options: ["0", "6", "7", "8", "Ninguna de ellas"] },
    { id: 33, text: "¿Qué cifra debería sustituir a la J en esta multiplicación? 1J56 × J = 582J", options: ["3", "4", "7", "9", "Ninguna de ellas"] },
    { id: 34, text: "¿Qué número debería sustituir a la T? 11/55 = 101/T", options: ["115", "505", "550", "555", "Ninguna de ellas"] },
    { id: 35, text: "¿Por qué número es exactamente divisible el producto de 423 × 26?", options: ["8", "11", "17", "18", "Ninguna de ellas"] },
    { id: 36, text: "(7/3) ÷ (2 4/5) =", options: ["15/98", "5/6", "35/24", "6 8/15", "Ninguna de ellas"] },
    { id: 37, text: "¿Qué cifra debería sustituir a la N en esta división exacta? 9N29 : 20N = 4N", options: ["3", "5", "7", "8", "Ninguna de ellas"] },
    { id: 38, text: "¿Por qué número es divisible exactamente el resultado de: 123 + 204 + 504 + 28?", options: ["12", "8", "6", "4", "Ninguna de ellas"] },
    { id: 39, text: "Diagrama de flujo: Si introduce el número 4, ¿cuál será el número al final? (Pasos: Sumar 6, si >12 dividir entre 2, si ≤3 multiplicar por 4)", options: ["8", "4", "2", "1", "Ninguna de ellas"] },
    { id: 40, text: "Diagrama de flujo: Si introduce el número 2, ¿cuántas veces pasará por el paso 4 para llegar al final?", options: ["1", "2", "3", "4", "Ninguna de ellas"] }
  ];

  // ========== DATOS TEST 5: RAZONAMIENTO ABSTRACTO (50 preguntas) ==========
  // Las respuestas correctas según el solucionario
  const ANSWERS_TEST5 = {
    1:"A", 2:"B", 3:"D", 4:"C", 5:"A", 6:"A", 7:"B", 8:"C", 9:"D", 10:"E",
    11:"B", 12:"C", 13:"A", 14:"D", 15:"E", 16:"E", 17:"D", 18:"C", 19:"B", 20:"A",
    21:"C", 22:"A", 23:"B", 24:"D", 25:"E", 26:"A", 27:"C", 28:"B", 29:"D", 30:"E",
    31:"A", 32:"B", 33:"E", 34:"D", 35:"C", 36:"C", 37:"A", 38:"D", 39:"B", 40:"E",
    41:"D", 42:"E", 43:"A", 44:"B", 45:"C", 46:"B", 47:"D", 48:"E", 49:"A", 50:"C"
  };

  // ========== DATOS TEST 6: RELACIONES ESPACIALES (50 preguntas) ==========
  // Las respuestas se definen como A, B, C o D
  const ANSWERS_TEST6 = {
    1:"C", 2:"D", 3:"A", 4:"B", 5:"B", 6:"A", 7:"A", 8:"D", 9:"B", 10:"C",
    11:"A", 12:"D", 13:"C", 14:"B", 15:"D", 16:"A", 17:"B", 18:"C", 19:"D", 20:"B",
    21:"C", 22:"A", 23:"B", 24:"D", 25:"D", 26:"A", 27:"A", 28:"D", 29:"C", 30:"B",
    31:"A", 32:"B", 33:"C", 34:"D", 35:"A", 36:"C", 37:"A", 38:"B", 39:"D", 40:"B",
    41:"C", 42:"A", 43:"B", 44:"C", 45:"D", 46:"B", 47:"D", 48:"A", 49:"A", 50:"C"
  };

  // ========== ESTADO GLOBAL ==========
  let user = {};
  let currentTest1Part = 1;
  let answersT1P1 = {};
  let answersT1P2 = {};
  let answersT2 = {};
  let answersT3 = {};
  let answersT4 = {};
  let answersT5 = {};
  let answersT6 = {};
  let timerInterval;
  let timeLeft = 180;

  // Variables para almacenar tiempos de cada test
  let timeTest1P1Start = 0, timeTest1P1End = 0;
  let timeTest1P2Start = 0, timeTest1P2End = 0;
  let timeTest2Start = 0, timeTest2End = 0;
  let timeTest3Start = 0, timeTest3End = 0;
  let timeTest4Start = 0, timeTest4End = 0;
  let timeTest5Start = 0, timeTest5End = 0;
  let timeTest6Start = 0, timeTest6End = 0;

  // ========== NAVEGACIÓN ==========
  function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
  }

  function goToInstructions() {
    const n = document.getElementById('userName').value.trim();
    const l = document.getElementById('userLast').value.trim();
    const e = document.getElementById('userEmail').value.trim();
    if(!n || !l || !e) return alert("Complete todos los campos");
    user = { name: n, lastname: l, email: e };
    showSection('instSection1');
  }

  // ========== TEST 1: RAPIDEZ ==========
  function startTest1Part(partNum) {
    currentTest1Part = partNum;
    timeLeft = 180; 
    
    if(partNum === 1) { timeTest1P1Start = Date.now(); }
    else { timeTest1P2Start = Date.now(); }
    
    const grid = document.getElementById('testGrid1');
    grid.innerHTML = '';
    const qs = DB_TEST1[partNum];
    
    qs.forEach(q => {
      const row = document.createElement('div');
      row.className = 'test-row';
      
      let optsHtml = '';
      q.options.forEach(opt => {
        optsHtml += `<button class="opt-btn" onclick="selectOptT1(${q.id}, '${opt}', this)">${opt}</button>`;
      });

      row.innerHTML = `
        <div class="q-id">${q.id}</div>
        <div class="q-target">${q.target}</div>
        <div class="q-options">${optsHtml}</div>
      `;
      grid.appendChild(row);
    });

    showSection('testSection1');
    document.getElementById('partTitle1').innerText = "PARTE " + (partNum === 1 ? "I" : "II");
    document.getElementById('timerDisplay').style.display = 'block';
    document.getElementById('pageTitle').innerText = 'Test 1: Rapidez y Exactitud Perceptiva';
    
    startTimer();
  }

  function selectOptT1(qId, val, btn) {
    if(currentTest1Part === 1) answersT1P1[qId] = val;
    else answersT1P2[qId] = val;
    
    const siblings = btn.parentElement.children;
    for(let s of siblings) s.classList.remove('selected');
    btn.classList.add('selected');
  }

  function finishTest1Part() {
    clearInterval(timerInterval);
    
    if(currentTest1Part === 1) {
      timeTest1P1End = Date.now();
      showSection('intermissionSection1');
    } else {
      timeTest1P2End = Date.now();
      showSection('transitionSection1to2');
    }
    document.getElementById('timerDisplay').style.display = 'none';
  }

  // ========== TEST 2: RAZONAMIENTO VERBAL ==========
  function showInstructions2() {
    showSection('instSection2');
    document.getElementById('pageTitle').innerText = 'Test 2: Razonamiento Verbal';
  }

  function startTest2() {
    timeTest2Start = Date.now();
    renderTest2Questions();
    showSection('testSection2');
    document.getElementById('timerDisplay').style.display = 'block';
    timeLeft = 1500;
    startTimer();
  }

  function renderTest2Questions() {
    const container = document.getElementById('questionsContainer2');
    container.innerHTML = '';
    const LETTERS = ['A', 'B', 'C', 'D', 'E'];

    QUESTIONS_TEST2.forEach((q, index) => {
      const div = document.createElement('div');
      div.className = 'question-item';
      
      let optionsHtml = '';
      q.options.forEach((optText, i) => {
        optionsHtml += `
          <div class="opt-btn-verbal" onclick="selectOptT2(${q.id}, '${LETTERS[i]}', this)">
            <span class="opt-letter">${LETTERS[i]}.</span> ${optText}
          </div>
        `;
      });

      div.innerHTML = `
        <span class="q-number">Pregunta ${index + 1}</span>
        <div class="q-text">${q.text}</div>
        <div class="options-list">${optionsHtml}</div>
      `;
      container.appendChild(div);
    });
  }

  function selectOptT2(qId, val, btnElem) {
    answersT2[qId] = val;
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    btnElem.classList.add('selected');
  }

  function finishTest2() {
    clearInterval(timerInterval);
    timeTest2End = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('transitionSection2to3');
  }

  // ========== TEST 3: ORTOGRAFÍA ==========
  function showInstructions3() {
    showSection('instSection3');
    document.getElementById('pageTitle').innerText = 'Test 3: Ortografía';
  }

  function startTest3() {
    timeTest3Start = Date.now();
    renderTest3Questions();
    showSection('testSection3');
    document.getElementById('timerDisplay').style.display = 'block';
    timeLeft = 600;
    startTimer();
  }

  function renderTest3Questions() {
    const container = document.getElementById('questionsContainer3');
    container.innerHTML = '';
    const LETTERS = ['A', 'B', 'C', 'D'];

    QUESTIONS_TEST3.forEach((q, index) => {
      const div = document.createElement('div');
      div.className = 'question-item-ortografia';
      
      let optionsHtml = '<div class="options-grid">';
      q.options.forEach((optText, i) => {
        optionsHtml += `
          <div class="opt-btn-verbal" onclick="selectOptT3(${q.id}, '${LETTERS[i]}', this)">
            <span class="opt-letter">${LETTERS[i]}.</span> ${optText}
          </div>
        `;
      });
      optionsHtml += '</div>';

      div.innerHTML = `
        <div class="q-number">${index + 1}.</div>
        ${optionsHtml}
      `;
      container.appendChild(div);
    });
  }

  function selectOptT3(qId, val, btnElem) {
    answersT3[qId] = val;
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    btnElem.classList.add('selected');
  }

  function finishTest3() {
    clearInterval(timerInterval);
    timeTest3End = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('transitionSection3to4');
  }

  // ========== TEST 4: RAZONAMIENTO NUMÉRICO ==========
  function showInstructions4() {
    showSection('instSection4');
    document.getElementById('pageTitle').innerText = 'Test 4: Razonamiento Numérico';
  }

  function startTest4() {
    timeTest4Start = Date.now();
    renderTest4Questions();
    showSection('testSection4');
    document.getElementById('timerDisplay').style.display = 'block';
    timeLeft = 1800; // 30 minutos
    startTimer();
  }

  function renderTest4Questions() {
    const container = document.getElementById('questionsContainer4');
    container.innerHTML = '';
    const LETTERS = ['A', 'B', 'C', 'D', 'E'];

    QUESTIONS_TEST4.forEach((q, index) => {
      const div = document.createElement('div');
      div.className = 'question-item';
      
      let optionsHtml = '';
      q.options.forEach((optText, i) => {
        optionsHtml += `
          <div class="opt-btn-verbal" onclick="selectOptT4(${q.id}, '${LETTERS[i]}', this)">
            <span class="opt-letter">${LETTERS[i]}.</span> ${optText}
          </div>
        `;
      });

      div.innerHTML = `
        <span class="q-number">Pregunta ${index + 1}</span>
        <div class="q-text">${q.text}</div>
        <div class="options-list">${optionsHtml}</div>
      `;
      container.appendChild(div);
    });
  }

  function selectOptT4(qId, val, btnElem) {
    answersT4[qId] = val;
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    btnElem.classList.add('selected');
  }

  function finishTest4() {
    clearInterval(timerInterval);
    timeTest4End = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('transitionSection4to5');
  }

  // ========== TEST 5: RAZONAMIENTO ABSTRACTO ==========
  function showInstructions5() {
    showSection('instSection5');
    document.getElementById('pageTitle').innerText = 'Test 5: Razonamiento Abstracto';
  }

  function startTest5() {
    timeTest5Start = Date.now();
    renderTest5Questions();
    showSection('testSection5');
    document.getElementById('timerDisplay').style.display = 'block';
    timeLeft = 1500; // 25 minutos
    startTimer();
  }

  function renderTest5Questions() {
    const container = document.getElementById('questionsContainer5');
    container.innerHTML = '';
    const LETTERS = ['A', 'B', 'C', 'D', 'E'];

    for(let i = 1; i <= 50; i++) {
      const div = document.createElement('div');
      div.className = 'question-visual';
      
      let optionsHtml = '<div class="visual-options">';
      LETTERS.forEach(letter => {
        optionsHtml += `<button class="visual-opt-btn" onclick="selectOptT5(${i}, '${letter}', this)">${letter}</button>`;
      });
      optionsHtml += '</div>';

      div.innerHTML = `
        <div class="q-number">Pregunta ${i}</div>
        <p style="text-align:center; color:#64748b; margin: 10px 0;">📄 Ver figura ${i} en el cuadernillo de imágenes</p>
        <img src="./img/abstracto/p${i}.png" alt="Pregunta ${i}" onerror="this.style.display='none'">
        ${optionsHtml}
      `;
      container.appendChild(div);
    }
    updateProgress5();
  }

  function selectOptT5(qId, val, btnElem) {
    answersT5[qId] = val;
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    btnElem.classList.add('selected');
    updateProgress5();
  }

  function updateProgress5() {
    const answered = Object.keys(answersT5).length;
    document.getElementById('progress5').style.width = (answered / 50 * 100) + '%';
    document.getElementById('progressText5').innerText = answered;
  }

  function finishTest5() {
    clearInterval(timerInterval);
    timeTest5End = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('transitionSection5to6');
  }

  // ========== TEST 6: RELACIONES ESPACIALES ==========
  function showInstructions6() {
    showSection('instSection6');
    document.getElementById('pageTitle').innerText = 'Test 6: Relaciones Espaciales';
  }

  function startTest6() {
    timeTest6Start = Date.now();
    renderTest6Questions();
    showSection('testSection6');
    document.getElementById('timerDisplay').style.display = 'block';
    timeLeft = 1500; // 25 minutos
    startTimer();
  }

  function renderTest6Questions() {
    const container = document.getElementById('questionsContainer6');
    container.innerHTML = '';
    const LETTERS = ['A', 'B', 'C', 'D'];

    for(let i = 1; i <= 50; i++) {
      const div = document.createElement('div');
      div.className = 'question-visual';
      
      let optionsHtml = '<div class="visual-options">';
      LETTERS.forEach(letter => {
        optionsHtml += `<button class="visual-opt-btn" onclick="selectOptT6(${i}, '${letter}', this)">${letter}</button>`;
      });
      optionsHtml += '</div>';

      div.innerHTML = `
        <div class="q-number">Pregunta ${i}</div>
        <p style="text-align:center; color:#64748b; margin: 10px 0;">📄 Ver figura ${i} en el cuadernillo de imágenes</p>
        <img src="./img/espacial/p${i}.png" alt="Pregunta ${i}" onerror="this.style.display='none'">
        ${optionsHtml}
      `;
      container.appendChild(div);
    }
    updateProgress6();
  }

  function selectOptT6(qId, val, btnElem) {
    answersT6[qId] = val;
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    btnElem.classList.add('selected');
    updateProgress6();
  }

  function updateProgress6() {
    const answered = Object.keys(answersT6).length;
    document.getElementById('progress6').style.width = (answered / 50 * 100) + '%';
    document.getElementById('progressText6').innerText = answered;
  }

  // ========== FINALIZAR TEST 6 Y ENVIAR TODOS LOS DATOS ==========
  function finishTest6() {
    clearInterval(timerInterval);
    timeTest6End = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('finalSection');
    
    // Calcular tiempos usados
    const tiempoTest1P1 = formatTimeUsed(timeTest1P1Start, timeTest1P1End);
    const tiempoTest1P2 = formatTimeUsed(timeTest1P2Start, timeTest1P2End);
    const tiempoTest2 = formatTimeUsed(timeTest2Start, timeTest2End);
    const tiempoTest3 = formatTimeUsed(timeTest3Start, timeTest3End);
    const tiempoTest4 = formatTimeUsed(timeTest4Start, timeTest4End);
    const tiempoTest5 = formatTimeUsed(timeTest5Start, timeTest5End);
    const tiempoTest6 = formatTimeUsed(timeTest6Start, timeTest6End);

    // Formatear respuestas
    const respuestasT1P1 = formatAnswers(answersT1P1);
    const respuestasT1P2 = formatAnswers(answersT1P2);
    const respuestasTest1 = `{PI: ${tiempoTest1P1} - ${respuestasT1P1}} {PII: ${tiempoTest1P2} - ${respuestasT1P2}}`;
    const respuestasTest2 = `{${tiempoTest2} - ${formatAnswers(answersT2)}}`;
    const respuestasTest3 = `{${tiempoTest3} - ${formatAnswers(answersT3)}}`;
    const respuestasTest4 = `{${tiempoTest4} - ${formatAnswers(answersT4)}}`;
    const respuestasTest5 = `{${tiempoTest5} - ${formatAnswers(answersT5)}}`;
    const respuestasTest6 = `{${tiempoTest6} - ${formatAnswers(answersT6)}}`;

    // Fecha y hora actual
    const now = new Date();
    const fechaHora = now.toLocaleString('es-AR', {
      day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
    });

    // ============================================================
    // FORMATO CORREGIDO: Usamos ARRAY (fila) como espera el Script
    // ============================================================
    const filaOrdenada = [
      user.name || "SinNombre",       // Columna A: Nombre
      user.lastname || "SinApellido", // Columna B: Apellido
      user.email || "SinEmail",       // Columna C: Email
      fechaHora,                      // Columna D: Fecha/Hora
      respuestasTest1,                // Columna E: Respuestas Prueba 1 (Rapidez)
      respuestasTest2,                // Columna F: Respuestas Prueba 2 (Verbal)
      respuestasTest3,                // Columna G: Respuestas Prueba 3 (Ortografia)
      respuestasTest4,                // Columna H: Respuestas Prueba 4 (Numerico)
      respuestasTest5,                // Columna I: Respuestas Prueba 5 (Abstracto)
      respuestasTest6                 // Columna J: Respuestas Prueba 6 (Espacial)
    ];

    const payload = {
      nombreHoja: "Respuestas",
      fila: filaOrdenada
    };
    
    console.log("Enviando a la base de datos:", payload);
    
    // URL ACTUALIZADA DE GOOGLE APPS SCRIPT
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwtRjfalEt9fuktj3gCUKRr66HoOSRvUdswRGmDPTKDbjknAAke4Umw9bTBR4OhzKPHyw/exec';
    
    fetch(GOOGLE_SCRIPT_URL, { 
      method: 'POST',
      mode: 'no-cors',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload) 
    })
    .then(() => {
      document.getElementById('loadingMsg').innerText = "¡Datos guardados correctamente!";
      document.getElementById('loadingMsg').style.color = "green";
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('loadingMsg').innerText = "⚠️ Error de conexión, avise al administrador.";
      document.getElementById('loadingMsg').style.color = "orange";
    });
  }

  // ========== FUNCIONES DE UTILIDAD ==========
  function formatTimeUsed(startTime, endTime) {
    if(!startTime || !endTime) return "0m 0s";
    const diffMs = endTime - startTime;
    const totalSeconds = Math.floor(diffMs / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}m ${seconds}s`;
  }

  function formatAnswers(answers) {
    const sortedIds = Object.keys(answers).map(Number).sort((a, b) => a - b);
    const formatted = sortedIds.map(id => `${id};${answers[id]}`).join(', ');
    return formatted || "Sin respuestas";
  }

  // ========== TIMER ==========
  function startTimer() {
    updateTimer();
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimer();
      if(timeLeft <= 0) {
        // Auto-finalizar según el test activo
        if(document.getElementById('testSection1').classList.contains('active')) {
          finishTest1Part();
        } else if(document.getElementById('testSection2').classList.contains('active')) {
          finishTest2();
        } else if(document.getElementById('testSection3').classList.contains('active')) {
          finishTest3();
        } else if(document.getElementById('testSection4').classList.contains('active')) {
          finishTest4();
        } else if(document.getElementById('testSection5').classList.contains('active')) {
          finishTest5();
        } else if(document.getElementById('testSection6').classList.contains('active')) {
          finishTest6();
        }
      }
    }, 1000);
  }

  function updateTimer() {
    const m = Math.floor(timeLeft / 60).toString().padStart(2,'0');
    const s = (timeLeft % 60).toString().padStart(2,'0');
    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
  }

</script>
</body>
</html>
