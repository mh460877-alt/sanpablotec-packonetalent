<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPP - Inventario de Intereses y Preferencias Profesionales</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* === ESTILOS GLOBALES === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      background-image: url('./img/fondo-escencial.jpg'); 
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 24px;
      color: #1e293b;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding: 40px;
      position: relative;
      overflow: hidden;
    }

    /* HEADER */
    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0;
    }
    .header h1 { color: #0f172a; font-size: 22px; font-weight: 700; }
    .timer-badge {
      background: #0b4a6e; color: white; padding: 8px 16px; border-radius: 12px;
      font-size: 18px; font-weight: 700; box-shadow: 0 4px 6px rgba(11, 74, 110, 0.2);
    }
    
    /* SECCIONES */
    .section { display: none; animation: fadeIn 0.4s ease-in-out; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* FORMULARIOS */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #475569; }
    .form-input {
      width: 100%; padding: 12px; border: 2px solid #cbd5e1; border-radius: 10px;
      font-size: 16px; transition: 0.3s;
    }
    .form-input:focus { border-color: #0b4a6e; outline: none; box-shadow: 0 0 0 3px rgba(11, 74, 110, 0.1); }

    /* BOTONES */
    .btn {
      background: linear-gradient(135deg, #0b4a6e 0%, #020f27 100%);
      color: white; border: none; padding: 14px 28px; border-radius: 10px;
      font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(11, 74, 110, 0.3); }
    .btn:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }

    /* INSTRUCCIONES */
    .instructions-box {
      background: #f1f5f9; padding: 25px; border-radius: 12px; border-left: 5px solid #0b4a6e;
      margin-bottom: 25px; line-height: 1.7; font-size: 15px; text-align: justify;
    }
    .instructions-box ul { margin-left: 20px; margin-top: 10px; }
    .instructions-box li { margin-bottom: 5px; }

    /* TEST WRAPPER */
    .test-wrapper {
      max-height: 520px; overflow-y: auto; padding-right: 10px;
      scroll-behavior: smooth;
    }
    .test-wrapper::-webkit-scrollbar { width: 8px; }
    .test-wrapper::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
    .test-wrapper::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .test-wrapper::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* PREGUNTAS IPP */
    .question-item {
      border-bottom: 1px solid #e2e8f0;
      padding: 14px 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: background 0.2s;
    }
    .question-item:hover { background: #f8fafc; }
    .question-item:nth-child(even) { background: #fafbfc; }
    .question-item:nth-child(even):hover { background: #f1f5f9; }
    .question-item.answered { border-left: 3px solid #0b4a6e; }
    
    .q-number {
      font-weight: bold;
      color: #0b4a6e;
      font-size: 0.85rem;
      min-width: 32px;
      text-align: center;
    }
    .q-text {
      flex: 1;
      font-size: 0.95rem;
      color: #334155;
      line-height: 1.4;
    }

    .options-ipp {
      display: flex;
      gap: 6px;
    }

    .opt-btn-ipp {
      width: 44px;
      height: 38px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.15s;
      background: white;
    }
    .opt-btn-ipp:hover {
      border-color: #94a3b8;
      background: #f1f5f9;
      transform: scale(1.05);
    }
    .opt-btn-ipp.selected-a {
      border-color: #059669;
      background: #d1fae5;
      color: #059669;
    }
    .opt-btn-ipp.selected-i {
      border-color: #d97706;
      background: #fef3c7;
      color: #d97706;
    }
    .opt-btn-ipp.selected-d {
      border-color: #dc2626;
      background: #fee2e2;
      color: #dc2626;
    }

    /* LEYENDA */
    .legend {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      padding: 12px 15px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 10px;
      justify-content: center;
      flex-wrap: wrap;
      border: 1px solid #e2e8f0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }
    .legend-color {
      width: 28px;
      height: 24px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.75rem;
    }
    .legend-a { background: #d1fae5; color: #059669; border: 2px solid #059669; }
    .legend-i { background: #fef3c7; color: #d97706; border: 2px solid #d97706; }
    .legend-d { background: #fee2e2; color: #dc2626; border: 2px solid #dc2626; }

    /* ESTADO INTERMEDIO */
    .intermission { text-align: center; padding: 40px; }
    .intermission h2 { color: #0b4a6e; margin-bottom: 15px; }

    /* PROGRESS BAR */
    .progress-container {
      margin-bottom: 15px;
    }
    .progress-bar {
      height: 10px;
      background: #e2e8f0;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0b4a6e, #1e88e5);
      transition: width 0.3s;
      border-radius: 5px;
    }
    .progress-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    .progress-text {
      font-size: 13px;
      color: #64748b;
      font-weight: 500;
    }
    .progress-percentage {
      font-size: 13px;
      color: #0b4a6e;
      font-weight: 700;
    }

    /* RESPONSIVE */
    @media (max-width: 600px) {
      .container { padding: 20px; }
      .header h1 { font-size: 18px; }
      .question-item { flex-wrap: wrap; gap: 10px; }
      .q-text { width: 100%; order: 2; }
      .options-ipp { order: 3; width: 100%; justify-content: flex-end; }
      .opt-btn-ipp { width: 50px; height: 42px; }
    }

  </style>
</head>
<body>

<div class="container">
  
  <div class="header">
    <h1 id="pageTitle">IPP - Inventario de Intereses y Preferencias Profesionales</h1>
    <div id="timerDisplay" class="timer-badge" style="display:none">00:00</div>
  </div>

  <!-- ========== REGISTRO ========== -->
  <div id="loginSection" class="section active">
    <h2 style="margin-bottom: 20px; color: #0f172a;">Registro del Postulante</h2>
    <div class="form-group">
      <label>Nombre</label>
      <input type="text" id="userName" class="form-input" placeholder="Ingrese su nombre">
    </div>
    <div class="form-group">
      <label>Apellido</label>
      <input type="text" id="userLast" class="form-input" placeholder="Ingrese su apellido">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="userEmail" class="form-input" placeholder="Ingrese su correo">
    </div>
    <button class="btn" onclick="goToInstructions()">Continuar</button>
  </div>

  <!-- ========== INSTRUCCIONES ========== -->
  <div id="instSection" class="section">
    <h2 style="margin-bottom: 20px; color: #0f172a;">Instrucciones</h2>
    <div class="instructions-box">
      <p>El <strong>IPP (Inventario de Intereses y Preferencias Profesionales)</strong> es un instrumento que permite explorar sus intereses vocacionales hacia distintos campos profesionales.</p>
      <br>
      <p>A continuación se presentarán <strong>108 actividades y profesiones</strong>. Para cada una, indique su preferencia personal:</p>
      <br>
      <div class="legend" style="justify-content: flex-start; background: white;">
        <div class="legend-item">
          <div class="legend-color legend-a">A</div>
          <span>= Me <strong>Agrada</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color legend-i">I</div>
          <span>= Me es <strong>Indiferente</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color legend-d">D</div>
          <span>= Me <strong>Desagrada</strong></span>
        </div>
      </div>
      <br>
      <p><strong>Recomendaciones:</strong></p>
      <ul>
        <li>No hay respuestas correctas ni incorrectas</li>
        <li>Responda según sus preferencias reales, no según lo que cree que debería gustarle</li>
        <li>No piense demasiado cada respuesta, confíe en su primera impresión</li>
        <li>Responda a todas las preguntas</li>
        <li>Tiempo estimado: 15-20 minutos</li>
      </ul>
    </div>
    <button class="btn" onclick="startTest()">COMENZAR TEST</button>
  </div>

  <!-- ========== TEST ========== -->
  <div id="testSection" class="section">
    <div class="progress-container">
      <div class="progress-bar"><div id="progressBar" class="progress-fill" style="width: 0%"></div></div>
      <div class="progress-info">
        <span class="progress-text">Respondidas: <span id="progressCount">0</span> / 108</span>
        <span class="progress-percentage" id="progressPercent">0%</span>
      </div>
    </div>
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color legend-a">A</div>
        <span>Agrada</span>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-i">I</div>
        <span>Indiferente</span>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-d">D</div>
        <span>Desagrada</span>
      </div>
    </div>
    <div id="questionsContainer" class="test-wrapper"></div>
    <button class="btn" style="margin-top: 20px;" id="finishBtn" onclick="finishTest()">FINALIZAR TEST</button>
  </div>

  <!-- ========== FINAL ========== -->
  <div id="finalSection" class="section intermission">
    <h2 style="color: #059669;">¡Test IPP Completado!</h2>
    <div style="font-size: 60px; margin: 20px 0;">✅</div>
    <p>Ha completado el Inventario de Intereses y Preferencias Profesionales.</p>
    <p style="margin-top: 10px;">Sus respuestas han sido registradas correctamente.</p>
    <div id="loadingMsg" style="margin-top:20px; color:#0b4a6e; font-weight:bold;">Guardando datos...</div>
  </div>

</div>

<script>
  // ========== DATOS: 108 ÍTEMS (6 por cada uno de los 18 campos) ==========
  // Mezclados entre actividades y profesiones para mayor dinamismo
  const ITEMS_IPP = [
    // CAMPO 1: CIENTÍFICO (C)
    { id: 1, text: "Investigar las causas de una enfermedad", campo: "C" },
    { id: 2, text: "Realizar experimentos en un laboratorio", campo: "C" },
    { id: 3, text: "Biólogo/a o Químico/a", campo: "C" },
    { id: 4, text: "Analizar datos de investigaciones científicas", campo: "C" },
    { id: 5, text: "Investigador/a científico/a", campo: "C" },
    { id: 6, text: "Estudiar el funcionamiento del cuerpo humano", campo: "C" },

    // CAMPO 2: TÉCNICO (T)
    { id: 7, text: "Reparar aparatos electrónicos o mecánicos", campo: "T" },
    { id: 8, text: "Diseñar planos técnicos", campo: "T" },
    { id: 9, text: "Ingeniero/a mecánico/a o industrial", campo: "T" },
    { id: 10, text: "Manejar herramientas y maquinaria", campo: "T" },
    { id: 11, text: "Técnico/a electrónico/a", campo: "T" },
    { id: 12, text: "Supervisar procesos de fabricación", campo: "T" },

    // CAMPO 3: SANITARIO (S)
    { id: 13, text: "Atender pacientes enfermos", campo: "S" },
    { id: 14, text: "Realizar primeros auxilios y curaciones", campo: "S" },
    { id: 15, text: "Médico/a o Enfermero/a", campo: "S" },
    { id: 16, text: "Asistir en intervenciones quirúrgicas", campo: "S" },
    { id: 17, text: "Fisioterapeuta o Nutricionista", campo: "S" },
    { id: 18, text: "Trabajar en urgencias hospitalarias", campo: "S" },

    // CAMPO 4: CIENTÍFICO-SOCIAL (CS)
    { id: 19, text: "Investigar problemas sociales", campo: "CS" },
    { id: 20, text: "Estudiar el comportamiento de grupos humanos", campo: "CS" },
    { id: 21, text: "Psicólogo/a o Sociólogo/a", campo: "CS" },
    { id: 22, text: "Realizar encuestas y estudios de opinión", campo: "CS" },
    { id: 23, text: "Antropólogo/a o Historiador/a", campo: "CS" },
    { id: 24, text: "Analizar tendencias económicas y sociales", campo: "CS" },

    // CAMPO 5: LITERARIO (L)
    { id: 25, text: "Escribir cuentos, novelas o artículos", campo: "L" },
    { id: 26, text: "Corregir textos y revisar ortografía", campo: "L" },
    { id: 27, text: "Escritor/a o Periodista", campo: "L" },
    { id: 28, text: "Traducir textos de otros idiomas", campo: "L" },
    { id: 29, text: "Editor/a o Guionista", campo: "L" },
    { id: 30, text: "Redactar discursos o contenido web", campo: "L" },

    // CAMPO 6: ARTÍSTICO-PLÁSTICO (AP)
    { id: 31, text: "Pintar cuadros o crear ilustraciones", campo: "AP" },
    { id: 32, text: "Diseñar logotipos y marcas", campo: "AP" },
    { id: 33, text: "Diseñador/a gráfico/a o Ilustrador/a", campo: "AP" },
    { id: 34, text: "Realizar fotografía artística", campo: "AP" },
    { id: 35, text: "Arquitecto/a o Diseñador/a de interiores", campo: "AP" },
    { id: 36, text: "Crear animaciones y efectos visuales", campo: "AP" },

    // CAMPO 7: MUSICAL (M)
    { id: 37, text: "Tocar un instrumento musical", campo: "M" },
    { id: 38, text: "Componer melodías y canciones", campo: "M" },
    { id: 39, text: "Músico/a profesional o Cantante", campo: "M" },
    { id: 40, text: "Dirigir un coro o una orquesta", campo: "M" },
    { id: 41, text: "Productor/a musical o DJ", campo: "M" },
    { id: 42, text: "Grabar y mezclar música en estudio", campo: "M" },

    // CAMPO 8: SOCIAL-ASISTENCIAL (SA)
    { id: 43, text: "Ayudar a personas con problemas personales", campo: "SA" },
    { id: 44, text: "Trabajar con comunidades vulnerables", campo: "SA" },
    { id: 45, text: "Trabajador/a social o Educador/a social", campo: "SA" },
    { id: 46, text: "Coordinar programas de voluntariado", campo: "SA" },
    { id: 47, text: "Orientador/a familiar o Mediador/a", campo: "SA" },
    { id: 48, text: "Defender derechos de grupos vulnerables", campo: "SA" },

    // CAMPO 9: ECONÓMICO-EMPRESARIAL (EE)
    { id: 49, text: "Gestionar presupuestos y finanzas", campo: "EE" },
    { id: 50, text: "Crear planes de negocio", campo: "EE" },
    { id: 51, text: "Administrador/a de empresas o Contador/a", campo: "EE" },
    { id: 52, text: "Dirigir equipos de trabajo", campo: "EE" },
    { id: 53, text: "Gerente o Director/a financiero/a", campo: "EE" },
    { id: 54, text: "Analizar mercados e inversiones", campo: "EE" },

    // CAMPO 10: PERSUASIVO-COMERCIAL (PC)
    { id: 55, text: "Vender productos o servicios", campo: "PC" },
    { id: 56, text: "Convencer a otros de una idea", campo: "PC" },
    { id: 57, text: "Vendedor/a profesional o Ejecutivo/a comercial", campo: "PC" },
    { id: 58, text: "Realizar presentaciones comerciales", campo: "PC" },
    { id: 59, text: "Director/a de marketing o Publicista", campo: "PC" },
    { id: 60, text: "Captar y fidelizar clientes", campo: "PC" },

    // CAMPO 11: ADMINISTRATIVO (A)
    { id: 61, text: "Organizar archivos y documentos", campo: "A" },
    { id: 62, text: "Gestionar agenda y coordinar reuniones", campo: "A" },
    { id: 63, text: "Secretario/a ejecutivo/a o Asistente", campo: "A" },
    { id: 64, text: "Procesar datos en hojas de cálculo", campo: "A" },
    { id: 65, text: "Auxiliar contable o Recepcionista", campo: "A" },
    { id: 66, text: "Realizar trámites y gestiones administrativas", campo: "A" },

    // CAMPO 12: JURÍDICO-POLÍTICO (JP)
    { id: 67, text: "Defender casos ante tribunales", campo: "JP" },
    { id: 68, text: "Redactar contratos y documentos legales", campo: "JP" },
    { id: 69, text: "Abogado/a o Juez/a", campo: "JP" },
    { id: 70, text: "Participar en debates políticos", campo: "JP" },
    { id: 71, text: "Político/a o Diplomático/a", campo: "JP" },
    { id: 72, text: "Asesorar sobre temas legales o normativos", campo: "JP" },

    // CAMPO 13: COMUNICACIÓN-INFORMACIÓN (CI)
    { id: 73, text: "Presentar noticias en radio o televisión", campo: "CI" },
    { id: 74, text: "Realizar entrevistas a personajes", campo: "CI" },
    { id: 75, text: "Presentador/a de TV o Locutor/a", campo: "CI" },
    { id: 76, text: "Gestionar redes sociales y contenido digital", campo: "CI" },
    { id: 77, text: "Productor/a audiovisual o Community Manager", campo: "CI" },
    { id: 78, text: "Editar videos y contenido multimedia", campo: "CI" },

    // CAMPO 14: ENSEÑANZA (E)
    { id: 79, text: "Explicar conceptos a estudiantes", campo: "E" },
    { id: 80, text: "Preparar materiales didácticos", campo: "E" },
    { id: 81, text: "Maestro/a o Profesor/a", campo: "E" },
    { id: 82, text: "Motivar a estudiantes en su aprendizaje", campo: "E" },
    { id: 83, text: "Orientador/a educativo/a o Pedagogo/a", campo: "E" },
    { id: 84, text: "Diseñar programas de formación", campo: "E" },

    // CAMPO 15: SEGURIDAD (SE)
    { id: 85, text: "Patrullar y vigilar zonas", campo: "SE" },
    { id: 86, text: "Investigar escenas de crímenes", campo: "SE" },
    { id: 87, text: "Policía o Detective", campo: "SE" },
    { id: 88, text: "Realizar rescates de emergencia", campo: "SE" },
    { id: 89, text: "Bombero/a o Militar", campo: "SE" },
    { id: 90, text: "Proteger personas o custodiar bienes", campo: "SE" },

    // CAMPO 16: DEPORTIVO (D)
    { id: 91, text: "Entrenar a deportistas", campo: "D" },
    { id: 92, text: "Planificar programas de entrenamiento", campo: "D" },
    { id: 93, text: "Entrenador/a deportivo/a o Preparador/a físico/a", campo: "D" },
    { id: 94, text: "Practicar deportes de competición", campo: "D" },
    { id: 95, text: "Deportista profesional o Árbitro/a", campo: "D" },
    { id: 96, text: "Organizar eventos deportivos", campo: "D" },

    // CAMPO 17: AGROPECUARIO-AMBIENTAL (AA)
    { id: 97, text: "Cultivar plantas y vegetales", campo: "AA" },
    { id: 98, text: "Proteger espacios naturales", campo: "AA" },
    { id: 99, text: "Ingeniero/a agrónomo/a o ambiental", campo: "AA" },
    { id: 100, text: "Trabajar en conservación de fauna", campo: "AA" },
    { id: 101, text: "Veterinario/a de campo o Guardaparques", campo: "AA" },
    { id: 102, text: "Gestionar recursos naturales y reciclaje", campo: "AA" },

    // CAMPO 18: INFORMÁTICO (I)
    { id: 103, text: "Programar aplicaciones o páginas web", campo: "I" },
    { id: 104, text: "Administrar bases de datos y redes", campo: "I" },
    { id: 105, text: "Programador/a o Desarrollador/a web", campo: "I" },
    { id: 106, text: "Desarrollar videojuegos o apps móviles", campo: "I" },
    { id: 107, text: "Ingeniero/a de software o Analista de sistemas", campo: "I" },
    { id: 108, text: "Implementar ciberseguridad o inteligencia artificial", campo: "I" }
  ];

  // ========== ESTADO GLOBAL ==========
  let user = {};
  let answers = {};
  let timeStart = 0, timeEnd = 0;
  let timerInterval;
  let elapsedSeconds = 0;

  // ========== NAVEGACIÓN ==========
  function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    window.scrollTo(0, 0);
  }

  function goToInstructions() {
    const n = document.getElementById('userName').value.trim();
    const l = document.getElementById('userLast').value.trim();
    const e = document.getElementById('userEmail').value.trim();
    if(!n || !l || !e) return alert("Complete todos los campos");
    user = { name: n, lastname: l, email: e };
    showSection('instSection');
  }

  // ========== TEST ==========
  function startTest() {
    timeStart = Date.now();
    renderQuestions();
    showSection('testSection');
    document.getElementById('timerDisplay').style.display = 'block';
    elapsedSeconds = 0;
    startTimer();
  }

  function renderQuestions() {
    const container = document.getElementById('questionsContainer');
    container.innerHTML = '';
    
    ITEMS_IPP.forEach(q => {
      const div = document.createElement('div');
      div.className = 'question-item';
      div.id = 'q-' + q.id;
      div.innerHTML = `
        <span class="q-number">${q.id}</span>
        <span class="q-text">${q.text}</span>
        <div class="options-ipp">
          <button class="opt-btn-ipp" onclick="selectAnswer(${q.id}, 'A', this)" title="Agrada">A</button>
          <button class="opt-btn-ipp" onclick="selectAnswer(${q.id}, 'I', this)" title="Indiferente">I</button>
          <button class="opt-btn-ipp" onclick="selectAnswer(${q.id}, 'D', this)" title="Desagrada">D</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function selectAnswer(qId, val, btnElem) {
    answers[qId] = val;
    
    // Actualizar estilos del botón
    const parent = btnElem.parentElement;
    Array.from(parent.children).forEach(child => {
      child.classList.remove('selected-a', 'selected-i', 'selected-d');
    });
    btnElem.classList.add('selected-' + val.toLowerCase());
    
    // Marcar pregunta como respondida
    document.getElementById('q-' + qId).classList.add('answered');
    
    updateProgress();
  }

  function updateProgress() {
    const answered = Object.keys(answers).length;
    const total = 108;
    const percent = Math.round((answered / total) * 100);
    
    document.getElementById('progressBar').style.width = percent + '%';
    document.getElementById('progressCount').innerText = answered;
    document.getElementById('progressPercent').innerText = percent + '%';
  }

  function finishTest() {
    const answered = Object.keys(answers).length;
    if(answered < 108) {
      if(!confirm(`Ha respondido ${answered} de 108 preguntas.\n\n¿Desea finalizar de todos modos?`)) {
        return;
      }
    }
    clearInterval(timerInterval);
    timeEnd = Date.now();
    document.getElementById('timerDisplay').style.display = 'none';
    showSection('finalSection');
    
    sendResults();
  }

  // ========== ENVIAR RESULTADOS ==========
  function sendResults() {
    const tiempoUsado = formatTimeUsed(timeStart, timeEnd);
    const respuestasFormateadas = formatAnswers(answers);
    
    // Formato final de respuestas
    const respuestasFinal = `{${tiempoUsado} - ${respuestasFormateadas}}`;

    // Fecha y hora actual
    const now = new Date();
    const fechaHora = now.toLocaleString('es-AR', {
      day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
    });

    // Formato de fila para Google Sheets
    const filaOrdenada = [
      user.name || "SinNombre",
      user.lastname || "SinApellido",
      user.email || "SinEmail",
      fechaHora,
      respuestasFinal
    ];

    const payload = {
      nombreHoja: "Respuestas",
      fila: filaOrdenada
    };

    console.log("Enviando a la base de datos:", payload);

    // URL DE GOOGLE APPS SCRIPT
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzJj_7uFx4R6rsS737YsgWt-EqmPCyLofj-ZsFjjdi32DezcaUE9PF0yPzvJKTm5r09bw/exec';
    
    fetch(GOOGLE_SCRIPT_URL, { 
      method: 'POST',
      mode: 'no-cors',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload) 
    })
    .then(() => {
      document.getElementById('loadingMsg').innerText = "¡Datos guardados correctamente!";
      document.getElementById('loadingMsg').style.color = "#059669";
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('loadingMsg').innerText = "⚠️ Error de conexión, avise al administrador.";
      document.getElementById('loadingMsg').style.color = "orange";
    });
  }

  // ========== FUNCIONES DE UTILIDAD ==========
  function formatTimeUsed(startTime, endTime) {
    if(!startTime || !endTime) return "0m 0s";
    const diffMs = endTime - startTime;
    const totalSeconds = Math.floor(diffMs / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}m ${seconds}s`;
  }

  function formatAnswers(answers) {
    const sortedIds = Object.keys(answers).map(Number).sort((a, b) => a - b);
    const formatted = sortedIds.map(id => `${id};${answers[id]}`).join(', ');
    return formatted || "Sin respuestas";
  }

  // ========== TIMER ==========
  function startTimer() {
    updateTimer();
    timerInterval = setInterval(() => {
      elapsedSeconds++;
      updateTimer();
    }, 1000);
  }

  function updateTimer() {
    const m = Math.floor(elapsedSeconds / 60).toString().padStart(2,'0');
    const s = (elapsedSeconds % 60).toString().padStart(2,'0');
    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
  }

</script>
</body>
</html>