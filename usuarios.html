<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SuperMercados Comodin - Evaluaciones</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="./img/favicon.png" sizes="32x32">
  <link rel="shortcut icon" href="./img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="./img/favicon.png">

  <!-- EXO 2 (T√≠tulos) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>

<style>
  :root {
    /* ‚úÖ PALETA ONE */
    --c-black: #000000;
    --c-ink: #1a181d;
    --c-white: #fefeff;
    --c-pink: #e17bd7;
    --c-cyan: #6be1e3;
    --c-gold: #e4c76a;
    --c-slate: #a4a8c0;
    --c-mist: #c6c9d7;

    /* tipograf√≠as */
    --font-title: "Exo 2", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --font-sub: "Futura", "Futura PT", "Avenir", "Trebuchet MS", "Segoe UI", Arial, sans-serif;

    /* layout */
    --container: 1200px;
    --radius-md: 12px;
    --radius-lg: 18px;
    --radius-xl: 28px;
    --shadow-soft: 0 18px 60px rgba(0, 0, 0, .55);
    --glass: rgba(254, 254, 255, .08);
    --glass2: rgba(254, 254, 255, .12);
    --stroke: rgba(198, 201, 215, .25);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0
  }

  html {
    scroll-behavior: smooth
  }

  body {
    margin: 0;
    color: var(--c-white);
    background: radial-gradient(1200px 700px at 70% 25%, rgba(225, 123, 215, .18), transparent 55%),
      radial-gradient(1100px 700px at 80% 60%, rgba(107, 225, 227, .14), transparent 55%),
      radial-gradient(900px 600px at 20% 70%, rgba(228, 199, 106, .10), transparent 60%),
      linear-gradient(180deg, var(--c-black), var(--c-ink));
    font-family: var(--font-sub);
    line-height: 1.5;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Fondo extra (hex + haze + estrellas) */
  .bg {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -2;
  }

  .bg::before {
    content: "";
    position: absolute;
    inset: -10%;
    background:
      radial-gradient(circle at 25% 20%, rgba(107, 225, 227, .12), transparent 40%),
      radial-gradient(circle at 80% 35%, rgba(225, 123, 215, .12), transparent 38%),
      radial-gradient(circle at 55% 85%, rgba(228, 199, 106, .10), transparent 45%);
    filter: blur(18px);
    opacity: .95;
    transform: translateZ(0);
  }

  .hex {
    position: absolute;
    inset: -20%;
    opacity: .16;
    filter: drop-shadow(0 0 12px rgba(107, 225, 227, .15));
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='150' viewBox='0 0 260 150'%3E%3Cg fill='none' stroke='%23c6c9d7' stroke-opacity='0.85' stroke-width='1'%3E%3Cpath d='M50 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M120 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M190 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M85 55l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M155 55l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M50 90l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M120 90l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M190 90l20-12 20 12v24l-20 12-20-12z'/%3E%3C/g%3E%3C/svg%3E");
    background-size: 260px 150px;
    background-repeat: repeat;
    transform: rotate(-8deg);
    mix-blend-mode: screen;
  }

  canvas#stars {
    position: absolute;
    inset: 0;
    opacity: 1;
  }

  .hidden {
    display: none !important;
  }

  /* =========================
     VISTA DE LOGIN
  ========================= */
  #login-view {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .login-container {
    width: 100%;
    max-width: 460px;
  }

  .login-card {
    background:
      radial-gradient(900px 600px at 70% 35%, rgba(225, 123, 215, .18), transparent 55%),
      radial-gradient(900px 600px at 45% 60%, rgba(107, 225, 227, .16), transparent 60%),
      linear-gradient(180deg, rgba(254, 254, 255, .07), rgba(26, 24, 29, .72));
    border-radius: var(--radius-lg);
    padding: 2.5rem 2rem;
    box-shadow: var(--shadow-soft);
    border: 1px solid rgba(198, 201, 215, .18);
    backdrop-filter: blur(16px);
  }

  .back-link {
    display: block;
    text-align: center;
    margin-top: 1.5rem;
    font-size: .85rem;
    color: rgba(198, 201, 215, .82);
    cursor: pointer;
    transition: color .2s ease;
  }

  .back-link:hover {
    color: var(--c-cyan);
  }

  .login-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  @keyframes logoPulse {

    0%,
    100% {
      box-shadow: 0 0 0 1px rgba(198, 201, 215, .18), 0 0 40px rgba(107, 225, 227, .18);
      transform: scale(1);
    }

    50% {
      box-shadow: 0 0 0 1px rgba(198, 201, 215, .22), 0 0 55px rgba(225, 123, 215, .22);
      transform: scale(1.03);
    }
  }

  .login-logo {
    width: 80px;
    height: 80px;
    border-radius: 999px;
    background-image: url('./img/comodin.png');
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 0 1px rgba(198, 201, 215, .18), 0 0 40px rgba(107, 225, 227, .18);
    animation: logoPulse 4.5s ease-in-out infinite;
    margin: 0 auto 1.5rem;
    position: relative;
    overflow: hidden;
  }

  .login-logo::after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 30%, rgba(254, 254, 255, .14), transparent 55%);
    pointer-events: none;
  }

  .login-title {
    font-family: var(--font-title);
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: .4rem;
    letter-spacing: -.01em;
    text-shadow: 0 10px 40px rgba(0, 0, 0, .55);
  }

  .login-subtitle {
    font-size: .92rem;
    color: rgba(198, 201, 215, .86);
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-size: .9rem;
    font-weight: 700;
    color: rgba(198, 201, 215, .88);
    margin-bottom: .5rem;
  }

  .form-input {
    width: 100%;
    padding: .9rem 1rem;
    font-size: .95rem;
    background: rgba(254, 254, 255, .06);
    border: 1px solid rgba(198, 201, 215, .22);
    border-radius: var(--radius-md);
    color: var(--c-white);
    transition: border-color .2s ease, background .2s ease, box-shadow .2s ease;
    outline: none;
    backdrop-filter: blur(12px);
  }

  .form-input:focus {
    border-color: rgba(107, 225, 227, .55);
    box-shadow: 0 0 0 3px rgba(107, 225, 227, .14);
    background: rgba(254, 254, 255, .075);
  }

  .form-input::placeholder {
    color: rgba(198, 201, 215, .55);
  }

  /* Bot√≥n ONE */
  .btn-primary {
    position: relative;
    width: 100%;
    min-height: 56px;
    padding: .85rem 1.5rem;
    font-size: .95rem;
    font-weight: 800;
    border-radius: 999px;
    color: var(--c-white);
    background: rgba(254, 254, 255, .06);
    border: 1px solid rgba(107, 225, 227, .35);
    cursor: pointer;
    transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
    box-shadow: 0 10px 40px rgba(0, 0, 0, .35);
    overflow: hidden;
    user-select: none;
    font-family: var(--font-sub);
    letter-spacing: .02em;
    backdrop-filter: blur(12px);
  }

  .btn-primary::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 999px;
    opacity: .75;
    filter: blur(10px);
    z-index: 0;
    transform: translateZ(0);
    background:
      radial-gradient(circle at 20% 50%, rgba(107, 225, 227, .55), transparent 55%),
      radial-gradient(circle at 80% 50%, rgba(107, 225, 227, .30), transparent 60%);
  }

  .btn-primary>span {
    position: relative;
    z-index: 1;
  }

  .btn-primary:hover:not(:disabled) {
    transform: translateY(-1px) scale(1.01);
    border-color: rgba(198, 201, 215, .36);
    background: rgba(254, 254, 255, .085);
    box-shadow: 0 16px 55px rgba(0, 0, 0, .45);
  }

  .btn-primary:disabled {
    opacity: .5;
    cursor: not-allowed;
  }

  .error-message {
    margin-top: 1rem;
    padding: .75rem 1rem;
    background: rgba(255, 90, 106, .12);
    border: 1px solid rgba(255, 90, 106, .22);
    border-radius: var(--radius-md);
    color: rgba(254, 254, 255, .9);
    font-size: .85rem;
    display: none;
    backdrop-filter: blur(10px);
  }

  .error-message.show {
    display: block;
  }

  .loading-message {
    margin-top: 1rem;
    padding: .75rem 1rem;
    background: rgba(225, 123, 215, .12);
    border: 1px solid rgba(198, 201, 215, .18);
    border-radius: var(--radius-md);
    color: rgba(254, 254, 255, .9);
    font-size: .85rem;
    text-align: center;
    display: none;
    backdrop-filter: blur(10px);
  }

  .loading-message.show {
    display: block;
  }

  /* =========================
     VISTA DE PANEL
  ========================= */
  #panel-view {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .header {
    position: sticky;
    top: 0;
    z-index: 40;
    background: rgba(0, 0, 0, .30);
    backdrop-filter: blur(14px);
    border-bottom: 1px solid rgba(198, 201, 215, .10);
  }

  .header-inner {
    max-width: var(--container);
    margin: 0 auto;
    padding: .9rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: .75rem;
  }

  .brand-logo {
    width: 36px;
    height: 36px;
    border-radius: 999px;
    background-image: url('./img/comodin.png');
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 0 1px rgba(198, 201, 215, .18), 0 0 30px rgba(107, 225, 227, .16);
    animation: logoPulse 4.5s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }

  .brand-logo::after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 30%, rgba(254, 254, 255, .14), transparent 55%);
    pointer-events: none;
  }

  .brand-text-main {
    font-family: var(--font-title);
    font-size: 1.05rem;
    font-weight: 800;
    letter-spacing: .02em;
  }

  .brand-text-sub {
    font-size: .82rem;
    color: rgba(198, 201, 215, .82);
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: .8rem;
    font-size: .86rem;
  }

  .user-pill {
    display: inline-flex;
    align-items: center;
    gap: .45rem;
    padding: .4rem .9rem;
    border-radius: 999px;
    background: rgba(254, 254, 255, .06);
    border: 1px solid rgba(198, 201, 215, .18);
    color: rgba(254, 254, 255, .9);
    font-weight: 700;
    backdrop-filter: blur(10px);
  }

  .user-dot {
    width: 7px;
    height: 7px;
    border-radius: 999px;
    background: var(--c-cyan);
    box-shadow: 0 0 18px rgba(107, 225, 227, .55);
  }

  .btn-secondary {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: .55rem 1rem;
    font-size: .86rem;
    font-weight: 800;
    border-radius: 999px;
    background: rgba(254, 254, 255, .04);
    color: rgba(198, 201, 215, .88);
    border: 1px solid rgba(198, 201, 215, .22);
    cursor: pointer;
    transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease, color .18s ease;
    backdrop-filter: blur(12px);
    overflow: hidden;
    user-select: none;
    font-family: var(--font-sub);
  }

  .btn-secondary:hover {
    transform: translateY(-1px);
    background: rgba(254, 254, 255, .07);
    border-color: rgba(225, 123, 215, .35);
    color: var(--c-white);
    box-shadow: 0 16px 45px rgba(0, 0, 0, .35);
  }

  .main-content {
    flex: 1;
    max-width: var(--container);
    width: 100%;
    margin: 0 auto;
    padding: 2rem 1.5rem 2.5rem;
  }

  .welcome-section {
    margin-bottom: 2.5rem;
  }

  .welcome-title {
    font-family: var(--font-title);
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: .5rem;
    letter-spacing: -.01em;
    text-shadow: 0 10px 40px rgba(0, 0, 0, .35);
  }

  .welcome-text {
    font-size: .95rem;
    color: rgba(198, 201, 215, .86);
  }

  .evaluations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .eval-card {
    display: none;
    background:
      radial-gradient(900px 600px at 70% 35%, rgba(225, 123, 215, .12), transparent 55%),
      radial-gradient(900px 600px at 45% 60%, rgba(107, 225, 227, .10), transparent 60%),
      linear-gradient(180deg, rgba(254, 254, 255, .06), rgba(26, 24, 29, .72));
    border: 1px solid rgba(198, 201, 215, .18);
    border-radius: var(--radius-lg);
    padding: 1.8rem;
    box-shadow: var(--shadow-soft);
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
    backdrop-filter: blur(16px);
  }

  .eval-card.visible {
    display: block;
  }

  .eval-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 28px 60px rgba(0, 0, 0, .65);
    border-color: rgba(107, 225, 227, .30);
    background:
      radial-gradient(900px 600px at 70% 35%, rgba(225, 123, 215, .16), transparent 55%),
      radial-gradient(900px 600px at 45% 60%, rgba(107, 225, 227, .14), transparent 60%),
      linear-gradient(180deg, rgba(254, 254, 255, .07), rgba(26, 24, 29, .70));
  }

  .eval-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    filter: drop-shadow(0 18px 35px rgba(0, 0, 0, .45));
  }

  .eval-name {
    font-family: var(--font-title);
    font-size: 1.25rem;
    font-weight: 800;
    margin-bottom: .8rem;
    color: var(--c-white);
    letter-spacing: -.01em;
  }

  .eval-desc {
    font-size: .92rem;
    color: rgba(198, 201, 215, .86);
    margin-bottom: 1.4rem;
    line-height: 1.6;
  }

  .btn-test {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: .5rem;
    width: 100%;
    min-height: 52px;
    padding: .72rem 1.2rem;
    font-size: .92rem;
    border-radius: 999px;
    border: 1px solid rgba(107, 225, 227, .35);
    background: rgba(254, 254, 255, .06);
    color: var(--c-white);
    font-weight: 800;
    cursor: pointer;
    transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
    box-shadow: 0 10px 40px rgba(0, 0, 0, .35);
    overflow: hidden;
    user-select: none;
    font-family: var(--font-sub);
    backdrop-filter: blur(12px);
  }

  .btn-test::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 999px;
    opacity: .75;
    filter: blur(10px);
    z-index: 0;
    transform: translateZ(0);
    background:
      radial-gradient(circle at 20% 50%, rgba(107, 225, 227, .55), transparent 55%),
      radial-gradient(circle at 80% 50%, rgba(107, 225, 227, .30), transparent 60%);
  }

  .btn-test>span,
  .btn-test {
    position: relative;
  }

  .btn-test>* {
    position: relative;
    z-index: 1;
  }

  .btn-test:hover {
    transform: translateY(-2px);
    border-color: rgba(198, 201, 215, .36);
    background: rgba(254, 254, 255, .085);
    box-shadow: 0 16px 55px rgba(0, 0, 0, .45);
  }

  .btn-test .arrow {
    transition: transform .15s ease;
  }

  .btn-test:hover .arrow {
    transform: translateX(3px);
  }

  .no-tests-message {
    display: none;
    text-align: center;
    padding: 3rem 2rem;
    background:
      radial-gradient(900px 600px at 70% 35%, rgba(225, 123, 215, .12), transparent 55%),
      radial-gradient(900px 600px at 45% 60%, rgba(107, 225, 227, .10), transparent 60%),
      linear-gradient(180deg, rgba(254, 254, 255, .06), rgba(26, 24, 29, .72));
    border: 1px solid rgba(198, 201, 215, .18);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-soft);
    backdrop-filter: blur(16px);
  }

  .no-tests-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: .55;
  }

  .no-tests-title {
    font-family: var(--font-title);
    font-size: 1.5rem;
    font-weight: 800;
    margin-bottom: .5rem;
  }

  .no-tests-text {
    font-size: .95rem;
    color: rgba(198, 201, 215, .86);
  }

  @media (max-width: 768px) {
    .header-inner {
      flex-wrap: wrap;
    }

    .evaluations-grid {
      grid-template-columns: 1fr;
    }

    .welcome-title {
      font-size: 1.55rem;
    }
  }

  /* accesibilidad */
  @media (prefers-reduced-motion: reduce) {

    .btn-primary,
    .btn-secondary,
    .btn-test {
      transition: none !important;
    }
  }
</style>

<body>
  <!-- Fondo ONE -->
  <div class="bg" aria-hidden="true">
    <canvas id="stars"></canvas>
    <div class="hex"></div>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE LOGIN -->
  <!-- ============================================ -->
  <div id="login-view">
    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <div class="login-logo"></div>
          <h1 class="login-title">Bienvenido</h1>
          <p class="login-subtitle">Panel de Evaluaci√≥n</p>
        </div>

        <form id="login-form">
          <div class="form-group">
            <label for="username" class="form-label">Usuario</label>
            <input type="text" id="username" class="form-input" placeholder="Ingresa tu usuario" required>
          </div>

          <div class="form-group">
            <label for="password" class="form-label">Contrase√±a</label>
            <input type="password" id="password" class="form-input" placeholder="Ingresa tu contrase√±a" required>
          </div>

          <button type="submit" class="btn-primary" id="login-btn">
            <span>Iniciar sesi√≥n</span>
          </button>
          <span class="back-link" id="back-to-participant">‚Üê Volver a la p√°gina de inicio</span>

          <div class="error-message" id="error-message"></div>
          <div class="loading-message" id="loading-message">Verificando credenciales...</div>
        </form>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DEL PANEL DE EVALUACIONES -->
  <!-- ============================================ -->
  <div id="panel-view" class="hidden">
    <header class="header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-logo"></div>
          <div>
            <div class="brand-text-main">Supermercados Comodin</div>
            <div class="brand-text-sub">Panel de Evaluaci√≥n</div>
          </div>
        </div>

        <div class="header-actions">
          <div class="user-pill">
            <span class="user-dot"></span>
            <span id="user-name-pill">Usuario</span>
          </div>
          <button class="btn-secondary" id="logout-button">Cerrar sesi√≥n</button>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="welcome-section">
        <h1 class="welcome-title">Tests Habilitados</h1>
        <p class="welcome-text" id="user-greeting">Aqu√≠ est√°n tus evaluaciones habilitadas.</p>
      </div>

      <div class="evaluations-grid">
        <!-- Test 1 -->
        <article class="eval-card" id="test-1">
          <div class="eval-icon">üß†</div>
          <h3 class="eval-name">Test 1:</h3>
          <p class="eval-desc">
            Descripcion del Test
          </p>
          <button class="btn-test" onclick="window.location.href='tests/Test1/index.html'">
            <span>Comenzar Test</span>
            <span class="arrow">‚Üí</span>
          </button>
        </article>

        <!-- Test 2 -->
        <article class="eval-card" id="test-2">
          <div class="eval-icon">‚è±Ô∏è</div>
          <h3 class="eval-name">Test 2:</h3>
          <p class="eval-desc">
            Descripcion del Test.
          </p>
          <button class="btn-test" onclick="window.location.href='tests/Test2/index.html'">
            <span>Comenzar Test</span>
            <span class="arrow">‚Üí</span>
          </button>
        </article>

        <!-- Test 3 -->
        <article class="eval-card" id="test-3">
          <div class="eval-icon">üìà</div>
          <h3 class="eval-name">Test 3:</h3>
          <p class="eval-desc">
            Descripcion del Test.
          </p>
          <button class="btn-test" onclick="window.location.href='tests/Test3/index.html'">
            <span>Comenzar Test</span>
            <span class="arrow">‚Üí</span>
          </button>
        </article>

        <!-- Test 4 -->
        <article class="eval-card" id="test-4">
          <div class="eval-icon">üë•</div>
          <h3 class="eval-name">Test 4:</h3>
          <p class="eval-desc">
            Descripcion del Test.
          </p>
          <button class="btn-test" onclick="window.location.href='tests/Test4/index.html'">
            <span>Comenzar Test</span>
            <span class="arrow">‚Üí</span>
          </button>
        </article>

      <!-- Mensaje cuando no hay tests habilitados -->
      <div class="no-tests-message" id="no-tests-message">
        <div class="no-tests-icon">üìã</div>
        <h2 class="no-tests-title">No tienes tests habilitados</h2>
        <p class="no-tests-text">No tienes tests habilitados en este momento. Por favor contact√° al administrador.</p>
      </div>
    </main>
  </div>

  <script>
    // ====== Part√≠culas "estrellas" ======
    const canvas = document.getElementById('stars');
    const ctx = canvas.getContext('2d', { alpha: true });

    let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio || 1, 2);
    let stars = [];
    const STAR_COUNT_BASE = 120;

    function resize() {
      W = window.innerWidth;
      H = window.innerHeight;
      DPR = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

      const count = Math.floor(STAR_COUNT_BASE * (W * H) / (1200 * 700));
      stars = Array.from({ length: Math.max(90, Math.min(220, count)) }, () => ({
        x: Math.random() * W,
        y: Math.random() * H,
        r: Math.random() * 1.35 + 0.25,
        a: Math.random() * 0.6 + 0.15,
        vx: (Math.random() - 0.5) * 0.06,
        vy: (Math.random() - 0.5) * 0.06,
        tw: Math.random() * 0.012 + 0.003
      }));
    }

    function draw() {
      ctx.clearRect(0, 0, W, H);

      const g = ctx.createRadialGradient(W * 0.75, H * 0.35, 0, W * 0.75, H * 0.35, Math.max(W, H) * 0.8);
      g.addColorStop(0, 'rgba(225,123,215,0.10)');
      g.addColorStop(0.35, 'rgba(107,225,227,0.08)');
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, W, H);

      for (const s of stars) {
        s.x += s.vx;
        s.y += s.vy;
        if (s.x < -10) s.x = W + 10;
        if (s.x > W + 10) s.x = -10;
        if (s.y < -10) s.y = H + 10;
        if (s.y > H + 10) s.y = -10;

        s.a += Math.sin((s.x + s.y) * 0.002) * s.tw;
        const alpha = Math.max(0.08, Math.min(0.85, s.a));

        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(254,254,255,${alpha})`;
        ctx.fill();
      }

      requestAnimationFrame(draw);
    }

    resize();
    draw();
    window.addEventListener('resize', resize);

    // ============================================
    // CONFIGURACI√ìN
    // ============================================
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzsNQg9fdpnWRzfxG3Ha_MBPS7sJwUhKzpj_OuVkkxV4uQeErV7Yd9FMW5TUFtCXI7t/exec';

    // ============================================
    // ELEMENTOS DEL DOM
    // ============================================
    const loginView = document.getElementById('login-view');
    const panelView = document.getElementById('panel-view');
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const errorMessage = document.getElementById('error-message');
    const loadingMessage = document.getElementById('loading-message');
    const backToParticipantBtn = document.getElementById('back-to-participant');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const userNamePill = document.getElementById('user-name-pill');
    const userGreeting = document.getElementById('user-greeting');
    const logoutButton = document.getElementById('logout-button');
    const noTestsMessage = document.getElementById('no-tests-message');

    let currentUser = null;

    // ============================================
    // FUNCIONES PRINCIPALES
    // ============================================
    function parseTestValue(testValue) {
      let testsArray = [];
      console.log('üìã Parseando valor de Test:', testValue, 'Tipo:', typeof testValue);

      if (testValue === undefined || testValue === null || testValue === '') return testsArray;

      if (typeof testValue === 'number') {
        const testStr = testValue.toString();
        if (testStr.includes('.')) {
          const parts = testStr.split('.');
          parts.forEach(part => { if (part && part !== '0') testsArray.push(part); });
        } else {
          testsArray.push(testStr);
        }
      } else if (typeof testValue === 'string') {
        if (testValue.includes(',')) {
          testsArray = testValue.split(',').map(t => t.trim()).filter(t => t);
        } else if (testValue.includes('.')) {
          const parts = testValue.split('.');
          parts.forEach(part => { if (part && part !== '0') testsArray.push(part.trim()); });
        } else {
          testsArray.push(testValue.trim());
        }
      }

      console.log('‚úÖ Tests parseados:', testsArray);
      return testsArray;
    }

    async function fetchAllUsers() {
      try {
        console.log('üì° Obteniendo usuarios desde Google Sheets...');

        const response = await fetch(`${GOOGLE_SCRIPT_URL}?accion=listar`, { method: 'GET' });
        if (!response.ok) throw new Error('Error al contactar con el servidor');

        const data = await response.json();
        console.log('üì¶ Datos recibidos del servidor:', data);

        if (!data || !Array.isArray(data.usuarios) || !Array.isArray(data.admin)) {
          throw new Error('Respuesta inv√°lida del servidor');
        }

        const users = data.usuarios.map((item, index) => {
          const testValue = item.Test || item.test;
          const testsArray = parseTestValue(testValue);

          const user = {
            id: item.id || index + 1,
            Usuario: item.Usuario || item.username || '',
            Contrase√±a: item.Contrase√±a || item.password || '',
            Puesto: item.Puesto || item.puesto || item.Cargo || '-',
            tests: testsArray,
            testRaw: testValue
          };

          console.log(`üë§ Usuario procesado: ${user.Usuario}, Tests: ${user.tests.join(',')}, Raw: ${user.testRaw}`);
          return user;
        });

        if (data.admin.length > 0) {
          const firstAdmin = data.admin[0];
          localStorage.setItem('adminData', JSON.stringify(firstAdmin));
          console.log('üîê Primer admin guardado en localStorage:', firstAdmin);
        }

        return users;
      } catch (error) {
        console.error('‚ùå Error al obtener usuarios:', error);
        throw error;
      }
    }

    function validateCredentials(username, password, users) {
      const user = users.find(u => {
        const userPassword = typeof u.Contrase√±a === 'number' ? u.Contrase√±a.toString() : u.Contrase√±a;
        const inputPassword = typeof password === 'number' ? password.toString() : password;

        return u.Usuario.toLowerCase() === username.toLowerCase() && userPassword === inputPassword;
      });
      return user || null;
    }

    function showPanel(user) {
      currentUser = user;

      loginView.classList.add('hidden');
      panelView.classList.remove('hidden');

      const userName = user.Usuario || 'Usuario';
      const userPuesto = user.Puesto || '';
      userNamePill.textContent = userName;
      userGreeting.textContent = `${userName}${userPuesto !== '-' ? ' - ' + userPuesto : ''}, aqu√≠ est√°n tus evaluaciones habilitadas.`;

      let enabledTests = user.tests || [];
      console.log('üéØ Tests habilitados para', userName, ':', enabledTests);

      document.querySelectorAll('.eval-card').forEach(card => card.classList.remove('visible'));

      if (enabledTests.length > 0) {
        enabledTests.forEach(testNumber => {
          const testCard = document.getElementById(`test-${testNumber}`);
          if (testCard) {
            testCard.classList.add('visible');
            console.log(`‚úÖ TEST ${testNumber} VISIBLE`);
          } else {
            console.warn(`‚ö†Ô∏è No se encontr√≥ el contenedor test-${testNumber}`);
          }
        });
        noTestsMessage.style.display = 'none';
      } else {
        console.log('‚ö†Ô∏è Usuario sin tests habilitados');
        noTestsMessage.style.display = 'block';
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      setTimeout(() => errorMessage.classList.remove('show'), 5000);
    }

    // ============================================
    // EVENTOS
    // ============================================
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      if (!username || !password) {
        showError('Por favor completa todos los campos');
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = 'Verificando...';
      errorMessage.classList.remove('show');
      loadingMessage.classList.add('show');

      try {
        const users = await fetchAllUsers();
        const authenticatedUser = validateCredentials(username, password, users);

        if (authenticatedUser) {
          // ‚úÖ Guardar sesi√≥n (sin contrase√±a)
          const sessionUser = {
            Usuario: authenticatedUser.Usuario,
            Puesto: authenticatedUser.Puesto,
            tests: authenticatedUser.tests
          };
          localStorage.setItem('sessionUser', JSON.stringify(sessionUser));
          localStorage.setItem('sessionLoggedIn', '1');

          // (si quer√©s caducidad opcional)
          // localStorage.setItem('sessionExpiresAt', String(Date.now() + 1000*60*60*6)); // 6h

          showPanel(authenticatedUser);
        } else {
          console.log('‚ùå Credenciales incorrectas');
          showError('Usuario o contrase√±a incorrectos');
          loginBtn.disabled = false;
          loginBtn.innerHTML = '<span>Iniciar sesi√≥n</span>';
          loadingMessage.classList.remove('show');
          loadingMessage.textContent = 'Verificando credenciales...';
        }

      } catch (error) {
        console.error('‚ùå Error en el login:', error);
        showError('Error al conectar con el servidor. Intenta nuevamente.');
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<span>Iniciar sesi√≥n</span>';
        loadingMessage.classList.remove('show');
        loadingMessage.textContent = 'Verificando credenciales...';
      }
    });

    logoutButton.addEventListener('click', () => {
      clearSession();
      console.log('üö™ Cerrando sesi√≥n...');

      document.querySelectorAll('.eval-card').forEach(card => card.classList.remove('visible'));

      panelView.classList.add('hidden');
      loginView.classList.remove('hidden');


      loginForm.reset();
      currentUser = null;
      loginBtn.disabled = false;
      loginBtn.innerHTML = '<span>Iniciar sesi√≥n</span>';
      loadingMessage.classList.remove('show');
      loadingMessage.textContent = 'Verificando credenciales...';
      errorMessage.classList.remove('show');
    });
    backToParticipantBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });
    // ============================================
    // INICIALIZACI√ìN
    // ============================================
    console.log('üöÄ Sistema de evaluaciones iniciado');

    // init estrellas
    // (ya se inicializa arriba con resize/draw)
    function restoreSessionIfAny() {
      const logged = localStorage.getItem('sessionLoggedIn') === '1';
      const raw = localStorage.getItem('sessionUser');
      if (!logged || !raw) return;

      try {
        const user = JSON.parse(raw);

        // (si usaste expiraci√≥n)
        // const exp = Number(localStorage.getItem('sessionExpiresAt') || 0);
        // if (exp && Date.now() > exp) return clearSession();

        showPanel(user);
      } catch (e) {
        clearSession();
      }
    }

    function clearSession() {
      localStorage.removeItem('sessionLoggedIn');
      localStorage.removeItem('sessionUser');
      localStorage.removeItem('sessionExpiresAt');
    }

    // ‚úÖ Llamar al iniciar
    restoreSessionIfAny();

  </script>
</body>

</html>